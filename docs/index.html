<!DOCTYPE html>
<html lang="en">

<head>
    <title>YourSqlDba Documentation</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
        rel='stylesheet' type='text/css'>
    <!-- FontAwesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.1.1/js/all.js" integrity="sha384-BtvRZcyfv4r0x/phJt9Y9HhnN5ur1Z+kZbKVgzVBAlQZX4jvAuImlIz+bG7TS00a"
        crossorigin="anonymous"></script>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
</head>

<body class="body-green">
    <div class="page-wrapper">
        <!-- ******Header****** -->
        <header id="header" class="header">
            <div class="container">
                <div class="branding">
                    <h1 class="logo">
                        <a href="index.html">
                            <span aria-hidden="true" class="icon_documents_alt icon"></span>
                            <span class="text-highlight">YourSql</span><span class="text-bold">Dba</span>
                        </a>
                    </h1>
                </div>
                <!--//branding-->
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item active">Quick Start</li>
                </ol>
            </div>
            <!--//container-->
        </header>
        <!--//header-->
        <div class="doc-wrapper">
            <div class="container">
                <div id="doc-header" class="doc-header text-center">
                    <h1 class="doc-title"><i class="icon fa fa-paper-plane"></i> Quick Start</h1>
                    <div class="meta"><i class="far fa-clock"></i> Dernière mise-à-jour: 23 october 2018</div>
                </div>
                <!--//doc-header-->
                <div class="doc-body row">
                    <div class="doc-content col-md-9 col-12 order-1">
                        <div class="content-inner">
                            <section id="intro-section" class="doc-section">
                                <h2 class="section-title">Introduction</h2>
                                <div class="section-block">
                                    <p>Welcome to your free tool for database maintenance. This tool performs
                                        automatically the bests practices of maintenance tasks required by the average
                                        DBA, without having any. It is also a great tool for occasional or professional
                                        DBAs who manage many databases. This is why we called it "YourSqlDba".</p>
                                    <p>For those seeking an installation of yourSqlDba go <a href="#installation-section">here</a>.</p>
                                    <p>Once installed, YourSqlDba is designed to require minimal knowledge of database
                                        administration to have automatic proper database maintenance.  This is always
                                        true for most small to mid-size instances and even quite larger ones.</p>
                                    <p>To make it simple, if you are able to perform maintenance of all your databases
                                        in a sequential manner with your actual hardware, YourSqlDba's default setup is
                                        likely be able to do it also.</p>
                                    <p>However if you are used to do maintenance by your own means may be you would
                                        like to split / parallelize maintenance tasks because your maintenance window
                                        is too long. I assume in this case that you probably have a basic knowledge of
                                        SQL Agent jobs/tasks and their schedules.</p>
                                    <p>From there you can take jobs and jobs steps of YourSqlDba default setup,
                                        duplicate them and adjust calls to YourSqlDba main procedure to segregate among
                                        database to be managed, management actions, and their individual schedules.
                                        YourSqlDba main procedure offers a powerful inclusion and exclusion pattern
                                        matching based on database names.</p>
                                    <p>To get acceptable maintenance windows, YourSqlDba spread over time some
                                        maintenance tasks (like updating statistics) over a week (specified through a
                                        parameter that can be modified). It only reorganize/rebuild indexes when they
                                        reach a fragmentation level threshold. These two behaviors reduce maintenance
                                        windows time over standard SSIS database maintenance tasks offered in SQL
                                        Server management studio.</p>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">News</h4>
                                            <p>Disable Microsoft SQL Server Error Usage And Reporting, see why:
                                                <a href="#disabling-telemetry">Here</a>
                                            </p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <!--//callout-block-->
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">IMPORTANT NOTE</h4>
                                            <p>To get the correct script use a capable Unicode browser like <strong>Edge</strong>,
                                                <strong>Chrome</strong> or <strong>Firefox</strong>.
                                            </p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <!--//callout-block-->
                                    <div class="callout-block callout-warning">
                                        <div class="icon-holder">
                                            <i class="fas fa-bug"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Check script integrity</h4>
                                            <p>Some situations makes displaying of the script source fail when it goes
                                                through a link to Github source. Actually (from August 2018) it seems
                                                to be more stable.  Insure that the displayed script is complete by
                                                checking that the script last instruction is:</p>
                                            <p><code>Exec Install.PrintVersionInfo</code></p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <!--//callout-block-->
                                </div>
                            </section>
                            <!--//doc-section-->
                            <section id="installation-section" class="doc-section">
                                <h2 class="section-title">Installation</h2>
                                <div id="step1" class="section-block">
                                    <h3 class="block-title">Step One</h3>
                                    <p>These links only display the script that you need to copy and paste and run from
                                        a SQL Server Management Studio query window.
                                    </p>
                                    <a href="https://raw.githubusercontent.com/pelsql/YourSqlDba/master/YourSQLDba_InstallOrUpdateScript.sql"
                                        class="btn btn-green" target="_blank"><i class="fas fa-download"></i>
                                        YourSQLDba_InstallOrUpdateScript.sql v6.5.8.0</a>
                                    <p>
                                        <h6>Run this script in Microsoft Management Studio</h6>
                                    </p>
                                    <p>
                                        You can also install a previous version of YourSqlDba. See the <a href="https://github.com/pelsql/YourSqlDba/commits/master/YourSQLDba_InstallOrUpdateScript.sql"
                                            target="_blank">History of versions for YourSQLDba</a>
                                    </p>
                                </div>
                                <!--//section-block-->
                                <div id="step2" class="section-block">
                                    <h3 class="block-title">Step Two</h3>
                                    <p>After running the script of one of the version above, and when installing
                                        YourSqlDba for the first time, don’t forget to run <a href="#InitialSetupOfYourSQLDba">Install.InitialSetupOfYourSqlDba</a>
                                        stored procedure. It needs only to be done at first install to setup database
                                        mail, backup directories.
                                    </p>
                                    <p><a href="#InitialSetupOfYourSQLDba" class="btn btn-orange"><i class="fas fa-link"></i> Initial Setup
                                            Examples</a></p>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Email notification</h4>
                                            <p>Allows you to customized YourSqlDba's parameters and makes YourSqlDba
                                                alive throught two SQLAgent jobs and able to communicate with your
                                                through SQL Server database mail.
                                            </p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <!--//callout-block-->
                                    <p>Further updates of YourSqlDba on the same SQL Server instance is just a matter
                                        of running the latest YourSqlDba script. There is no need to run
                                        InitialSetupOfYourSqlDba again. Customization done to SQL Agent's YourSqlDba's
                                        jobs is preserved.
                                    </p>
                                </div>
                                <!--//section-block-->
                                <div id="step3" class="section-block">
                                    <h3 class="block-title">Your Contribution</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="fas fa-thumbs-up"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Contribute to YourSqlDba</h4>
                                            <p>For those who want to contribute to YourSqlDba code, YourSqlDba is
                                                hosted on <a href="https://github.com/pelsql/YourSqlDba">GitHub</a>.</p>
                                            <p>Here is a <a href="https://services.github.com/on-demand/downloads/github-git-cheat-sheet/">quick
                                                    summary</a> of how to work with Github.</p>
                                            <p>Here is a <a href="https://services.github.com/on-demand/resources/cheatsheets/">multilingual
                                                    site</a>
                                                for the equivalent summary in different formats (Html, Pdf).</p>
                                            <p>There is also an excellent 1 hour <a href="https://www.youtube.com/watch?v=U8GBXvdmHT4">Youtube</a>
                                                video that makes very clear of what is GIT, I recommend it to feel
                                                confident with using this source
                                                control.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <!--//callout-block-->
                                </div>
                                <!--//section-block-->
                            </section>
                            <!--//doc-section-->

                            <section id="quickstart-section" class="doc-section">
                                <h2 class="section-title">Quick Start</h2>
                                <div id="summary-for-dba" class="section-block">
                                    <h3 class="block-title">YourSqlDba Summary for DBA</h3>
                                    <p>YourSqlDba becomes alive through two SQL Agent jobs that must be set initially
                                        by you, by executing stored procedure <a href="#InitialSetupOfYourSQLDba">Install.InitialSetupOfYourSqlDba</a>.</p>
                                    <p>The role of YourSqlDba Full Maintenance job is to perform daily maintenance and
                                        full backups at 00:00 and the role of YourSqlDba Log backpus is to do log
                                        backups every 15 minutes. The default schedule, email operator for them are all
                                        SQL Agent job parameters and can be modified to your convenience.</p>
                                    <p>The rest of the parameters are part of job tasks in the form of parameters the
                                        call of <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint's</a> stored procedure. You may need to modify
                                        them to tune some parameters like exclusion of databases from full recovery
                                        policy check.</p>
                                    <p>Go to Set up Mirror-Standby server section, if you are planning to configure
                                        standby server for recovery or to make downtime minimal when upgrading to a
                                        newer version of SQL Server.</p>
                                    <p>General daily maintenance job is scheduled at 00:00 Am through SQL Agent
                                        scheduled associated to the job. Logs backups are scheduled by the same mean at
                                        every 15 minutes all across the day. These schedules are the default one and
                                        can be modified on a job by job basis.</p>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Databases maintained</th>
                                                    <th>Maintenance done</th>
                                                    <th>Include filter parameter</th>
                                                    <th>Exclude filter parameter</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">All databases</th>
                                                    <td>SQ Server logs recycling, SQL Agent log cleanup, backup history
                                                        cleanup.  Keeps 30 days of  backup history, 30 days of SQL
                                                        Server logs, which are recycled each day.</td>
                                                    <td>N/A</td>
                                                    <td>N/A</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Master, Model, MsDb</th>
                                                    <td>Old backup cleanup, complete backups, integrity check, updating
                                                        optimizer statistics, intelligent index reorganization.</td>
                                                    <td>Always included</td>
                                                    <td>Never excluded</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">User databases</th>
                                                    <td>Old backup cleanup, complete and log backups, integrity check,
                                                        updating optimizer statistics, intelligent index
                                                        reorganization.</td>
                                                    <td>By default all, otherwise database name must match one of the
                                                        SQL like filter, in the like list.</td>
                                                    <td>By default none.  If Specified reduce what's left by the
                                                        include filter.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                    <h3>Full maintenance job</h3>
                                    <h4>YourSQLDba_FullBackups_And_Maintenance</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Task performed</th>
                                                    <th>When</th>
                                                    <th>Results an on what</th>
                                                    <th>Results</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">Database complete backup files removal</th>
                                                    <td>Once daily at maintenance time. (1st task)</td>
                                                    <td>.Bak files older than 1 day (parameter value default)</td>
                                                    <td>The resulting backup directory only keeps last complete backup,
                                                        unless you modify YourSqlDba parameter.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Database log backups file removal</th>
                                                    <td>Once daily at maintenance time. (1st task)</td>
                                                    <td>.Trn files older than 8 days (parameter value default)</td>
                                                    <td>The resulting backup directory keeps for eigth days of log
                                                        backup, unless you modify YourSqlDba parameter.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Integrity check</th>
                                                    <td>Once daily at maintenance time. (2nd task)</td>
                                                    <td>All system databases and selected user databases.</td>
                                                    <td>If integrity errors are found on a database, it is put offline.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Optimizer statistics update</th>
                                                    <td>Once daily at maintenance time. (3rd task)</td>
                                                    <td>Update stats is done on 1/7 of all  tables of each selected
                                                        database.</td>
                                                    <td>
                                                        <p>By parameter default this fraction is 7, so all database
                                                            tables are finally updated on a week basis.</p>
                                                        <p>Parameter can be changed a smaller number, to shorten the
                                                            full cycle on all tables.</p>
                                                        <p>Tables with &lt; 100K rows are updated with fullscan, bigger
                                                            table with 30% sampling.</p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Index reorganization</th>
                                                    <td>Once daily at maintenance time on selected indexes.(4th task)</td>
                                                    <td>For indexes on which fragmentation is above 5%</td>
                                                    <td>Once ran, most of the reorganization are going to be done with
                                                        index reorganization, not index rebuild because index typically
                                                        index doesn't fragment this quickly from day to day.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Complete backup and first log backup</th>
                                                    <td>Once daily  at maintenance time on selected databases. (5th
                                                        task)</td>
                                                    <td>Resulting databases based on included and exclude filter
                                                        combination.</td>
                                                    <td>
                                                        <p>.Bak files named by the database name, backup date.</p>
                                                        <p class="example">Example:</p>
                                                        <code>MyDb_[2013-05-14_13h21m24_Tue]_database.Bak</code>
                                                        <p>.Trn files named by the database name, backup date.</p>
                                                        <p class="example"> Example:</p>
                                                        <code>MyDb_[2013-05-14_13h21m24_Tue]_logs.Trn</code>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Error log recycling</th>
                                                    <td>Once daily  at maintenance time</td>
                                                    <td>Actual server log become an archive</td>
                                                    <td>
                                                        <p>YourSqlDba keeps 30 days of server logs which give 30 logs</p>
                                                        <p class="example">Example :</p>
                                                        <div class="code-block">
                                                            <pre><code class="language-sql">EXEC xp_instance_regwrite
N'HKEY_LOCAL_MACHINE',
N'Software\Microsoft\MSSQLServer\MSSQLServer',
N'NumErrorLogs',
REG_DWORD,
31</code></pre>
                                                        </div>
                                                        <!--//code-block-->
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Log History backup</th>
                                                    <td>Once daily  at maintenance time</td>
                                                    <td>Delete stuff older that 30 days</td>
                                                    <td>
                                                        <p>YourSqlDba keeps 30 days of history</p>
                                                        <p class="example">Example:</p>
                                                        <code>Exec Msdb.dbo.sp_delete_backuphistory</code>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Mail history log</th>
                                                    <td>""</td>
                                                    <td>""</td>
                                                    <td>
                                                        <p class="example">Example:</p>
                                                        <code>Exec msdb.dbo.sysmail_delete_log_sp</code>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Mail items</th>
                                                    <td>""</td>
                                                    <td>""</td>
                                                    <td>
                                                        <p class="example">Example:</p>
                                                        <code>Exec msdb.dbo.sysmail_delete_mailitems_sp</code>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Backup history</th>
                                                    <td>""</td>
                                                    <td>""</td>
                                                    <td>
                                                        <p class="example">Example:</p>
                                                        <code>Exec Msdb.dbo.sp_delete_backuphistory</code>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Job history</th>
                                                    <td>""</td>
                                                    <td>""</td>
                                                    <td>
                                                        <p class="example">Example:</p>
                                                        <code>Exec Msdb.dbo.sp_purge_jobhistory</code>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Maintenance history</th>
                                                    <td>""</td>
                                                    <td>""</td>
                                                    <td>
                                                        <p class="example">Example:</p>
                                                        <code>Exec Msdb.dbo.sp_maintplan_delete_log</code>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                    <h3>Logs'backup Job</h3>
                                    <h4>YourSQLDba_LogBackups</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Task performed</th>
                                                    <th>When</th>
                                                    <th>To What</th>
                                                    <th>Results</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">Log backup</td>
                                                    <td>Every 15 minutes</td>
                                                    <td>.Trn files</td>
                                                    <td>Every log backup is append to the day's log backup file created
                                                        when full maintenance ran.</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">Log file shrink</td>
                                                    <td>When log file expands beyond a size related to database files
                                                        in a 40% ratio.</td>
                                                    <td>Computed size are added as following:  Real size for files of
                                                        primary group, 1/10 for other.</td>
                                                    <td>Avoids frequents resizing, which fragment disk space.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="goodies-for-dba" class="section-block">
                                    <h3 class="block-title">Goodies for DBA</h3>
                                    <p>Aside maintenance, YourSqlDba offers stored procedures and functions handy for
                                        DBA.  Here is a quick list:</p>
                                      <h4>YourSqlDba Main maintenance procedure</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Procedure</th>
                                                    <th>Purpose</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a></td>
                                                    <td>Does all maintenance actions described in YourSqlDba Summary
                                                        for DBA page of this section.  Aside default job, allows adding
                                                        other maintenance jobs  with different and possibly concurrent
                                                        schedules and or or job steps with different database filters.</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.BringBackOnlineAllOfflineDb</td>
                                                    <td>Fast way to reset all offline database to online.  It may
                                                        happens if corruption is detected for your database files, or
                                                        if no valid backups were performed for these databases since
                                                        the time specified upon initial setup of YourSqlDba.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                    <h4>YourSqlDba's Setup procedures</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Procedure</th>
                                                    <th>Purpose</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Install.InitialSetupOfYourSqlDba</td>
                                                    <td>
                                                        <p>Creates two SQL Agent jobs for YourSqlDba maintenance that
                                                            calls <a href="#YourSQLDba_DoMaint">Maint.YourSqlDba_DoMaint</a> (see YourSqlDba Job Summary
                                                            for Dba) and configure SQL Agent for email reporting.</p>
                                                        <p>Configures also Database Mail for YourSqlDba maintenance
                                                            reporting.</p>
                                                        <p>Last, configures maximum of consecutive days without backups
                                                            for any given database before turning it offline.</p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <ul class="table-list">
                                                            <li>Maint.CreateNetworkDrives</li>
                                                            <li>Maint.ListNetworkDrives</li>
                                                            <li>Maint.DisconnectNetworkDrive</li>
                                                        </ul>
                                                    </td>
                                                    <td>Manage auto-mounted network drive letters. Set also information
                                                        for master auto start procedure
                                                        <strong>dbo.YourSqlDbaAutostart_ReconnectNetworkDrive</strong>. This procedure
                                                        associates UNC path to a drive letter. This is the only stored
                                                        procedure of YourSqlDba that is installed into master database.
                                                        Network drives are a way to shorten access to network location,
                                                        instead of using UNC paths.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                    <h4>Mirroring (YourSqldba standby server flavor) related procedure</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Procedure</th>
                                                    <th>Purpose</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Mirroing.AddServer</td>
                                                    <td>Configures a Linked server for the purpose of YourSqlDba
                                                        database mirroring (which is in fact a
                                                        YourSqlDba standby server).</td>
                                                </tr>
                                                <tr>
                                                    <td>Mirroring.DropServer</td>
                                                    <td>Remove linked server created for the purpose of YourSqlDba
                                                        database mirroring.</td>
                                                </tr>
                                                <tr>
                                                    <td>Mirroring.DoRecovery</td>
                                                    <td>Do a recovery of mirror/standby databases and put local
                                                        matching databases offline.</td>
                                                </tr>
                                                <tr>
                                                    <td>Mirroring.Failover</td>
                                                    <td>Failover selected databases to standby server.</td>
                                                </tr>
                                                <tr>
                                                    <td>Upgrade.MakeDbComptabileToTarget</td>
                                                    <td>Called by Mirroring.failover when using Mirroring as a mean to
                                                        migrate databases to another instance
                                                        with a newer version. Its set compatibility level to match
                                                        current version instance. If source database
                                                        is SQL Server 2005 and target instance is a newer version, it
                                                        converts full text catalog to the new
                                                        file storage format of the newer versions.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                    <h4>Diagnosis related procedures and functions</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Procedure/function</th>
                                                    <th>Purpose</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Maint.ShowHistory</td>
                                                    <td>Show YouSqlDba job history. Output can be filter by anyone of
                                                        this parameters in combination: Job
                                                        number, Error filtering only, Results Display limit, More
                                                        detailed diagnostics messages.</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.ShowHistoryErrors</td>
                                                    <td>Same as using Maint.ShowHistory with Error Filtering only. Job
                                                        number and display limit are optional.</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.DiagDbMail</td>
                                                    <td>Helps resolve email issues by listing MSDB log tables related
                                                        to database mail.</td>
                                                </tr>
                                                <tr>
                                                    <td>Install.PrintVersionInfo</td>
                                                    <td>List actual version of YourSqlDba.  Can also be selected from
                                                        function Install.VersionInfo.</td>
                                                </tr>
                                                <tr>
                                                    <td>PerfMon.ResetAnalyzeWaitStats</td>
                                                    <td>Reset wait stats info once before starting monitoring SQL
                                                        Server WaitStats. Intended to be used with
                                                        function PerfMon.AnalyzeWaitStats.</td>
                                                </tr>
                                                <tr>
                                                    <td>PerfMon.AnalyzeWaitStats</td>
                                                    <td>Reports wait stats averaged over time since last execution of
                                                        PerfMon.ResetAnalyzeWaitStats. Use
                                                        <code>Select * from PerfMon.AnalyzeWaitStats</code></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                    <h4>Manual backup related procedures</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Procedure</th>
                                                    <th>Purpose</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Maint.SaveDbCopyOnly</td>
                                                    <td>Save a copy of a database without affecting backup history and
                                                        log backup restore sequences.</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.SaveDbOnNewFileSet</td>
                                                    <td>Save a copy of a database using YourSqlDba naming and
                                                        convention for database files. Requires minimal
                                                        parameters (ex: only database name) if last backup location is
                                                        still ok for use.</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.duplicateDb</td>
                                                    <td>Save and restore a copy of a database onto the same server. 
                                                        There is an option to retain the backup file.
                                                        Very quick way to get a copy of a database.</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.duplicateDbFromBackupHistory</td>
                                                    <td>Makes a copy from a database using most up-to-date backup from
                                                        backup history. This is an even quicker way to get a copy of an
                                                        existing database, since it uses existing backups.</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.DeleteOldBackups</td>
                                                    <td>Delete old backups files</td>
                                                </tr>
                                                <tr>
                                                    <td>Maint.BringBackOnlineAllOfflineDb</td>
                                                    <td>Reset offline status off all offline DB. This may happen when
                                                        YourSqlDba put databases offline, for databases for which no
                                                        backups where taken successfully for a given number of days
                                                        selected by user.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                    <p>Get easily exclusive access to databases : See section <a href="">Exclusive
                                            access and backups for database upgrades</a>.</p>
                                </div>
                                <div id="release-6" class="section-block">
                                    <h3 class="block-title">Release 6</h3>
                                    <p>Hi everybody!  This new release deserve special attention because it brings long
                                        awaited features:</p>
                                    <h4>Security modifications to YourSqlDba</h4>
                                    <p>YourSqlDba required the existence of SA account in its previous versions. Since
                                        some DBA disable this account to
                                        replace it by another, it prevented using YourSqlDba with them. Now upon
                                        upgrade or install the script will
                                        create a YourSqlDba login with sysadmins privileges and a random generated
                                        password that you can modify to your
                                        convenience. You can then use the same YourSqlDba account and password account
                                        on all your sql instances
                                        connected by YourSqlDba mirroring.</p>
                                    <p>Across releases of minor versions of release 6, some modifications were made to
                                        make this feature to
                                        auto-correct itself. HOWEVER, if you have a setup of multiple servers mirroring
                                        to a single server, you must
                                        run <a href="#SetYourSqlDbaAccountForMirroring">Mirroring.SetYourSqlDbaAccountForMirroring</a> with
                                        @YourSqlDbaAccountForMirroringPwd parameter
                                        value set for every source server targeting the same mirror.</p>

                                    <h4>Differential backups!!!</h4>
                                    <p>There is a new value in <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> for parameter
                                        @DoBackup to specify a
                                        differential backup. For those who are newbies to the concept of differential
                                        backups, it is a in between
                                        solution between full backups and log backups. A database recovery with
                                        differential backups still requires a
                                        valid full backup, but all logs backup performed in between this full backup
                                        and the last differential backup
                                        done and used in recovery are not required. In other words it speed up
                                        recovery.</p> 
                                    <p>Differential backups tends to grow as long as a new full backup is not
                                        performed. It is the history of all
                                        changes performed to the database since the last full backup. Log backups on
                                        the other hand are proportional to
                                        the amount of changes done to the database between log backups. If you keep
                                        multiple differential backups,
                                        between full backup, there is some part of them who will have the same content.
                                        However this is a great
                                        solution that affords to get some point in time recovery on very large
                                        databases in simple recovery mode, for
                                        which the amount of change is quite small in proportion of the complete
                                        database.</p>
                                    <p>Typical use of differential backup is against very large database for which a
                                        full backup is done one every
                                        week, followed by differential backups every day, and log backups. Differential
                                        backups doesn't affect
                                        capability to do point in time recovery from logs backups. SQL Management
                                        Studio will remove useless log backup
                                        restores between full backup and differential backup chosen.</p>

                                    <h4>DBCC Scalability feature: DBCC full depth scan spreading over n full
                                        maintenances!!</h4>
                                    <p>A new parameter @spreadCheckDb allows to vary DBCC depth scanning over a given
                                        number of maintenances. For every
                                        database for which page verification is based on checksums a faster DBCC
                                        checkDb going to be performed by
                                        adding WITH PHYSICAL_ONLY option. Most if not all integrity problem are caused
                                        by the IO subsystem failures.
                                        When this option is added to DBCC CheckDB, it does more limited scan of the
                                        database structures, but theses
                                        failures are going to be detected by checksum.</p>
                                    <p>So YourSqlDba strategy regarding DBCC CheckDb in now this one:</p>
                                    <ul>
                                        <li>If the page option verification IS NOT SET to "Checksum" always perform
                                            DBCC CheckDb without the option, so
                                            full DBCC is kept.</li>
                                        <li>If the page option verification IS SET to "Checksum", perform most of the
                                            time DBCC CheckDb .. WITH
                                            PHYSICAL_ONLY option, except when it comes to the day for which it is this
                                            database turn to be fully DBCC
                                            checked without this option. Here is the role of the @spreadCheckDb
                                            parameter which make n "buckets" in
                                            which to separate databases. N is your choice, it can be tuned to you
                                            needs. By putting it equal to 1 it
                                            disable this behavior. Your are going to always get full DBCC in this case.</li>
                                        <li>A special algorithm make choice selection of which databases goes into
                                            which bucket about this way. Makes n
                                            "tile" of databases by decreasing database size. Then take the nth database
                                            of each group accordingly to
                                            the nth bucket for which it is turn to performed a full checkDb.</li>
                                    </ul>
                                    <h4>Mirroring</h4>
                                    <ul>
                                        <li>Mirroring.AddServer allows now to specify the data source that matches
                                            linked servername like its IP address.
                                            This bypass DNS.</li>
                                        <li>
                                            <p>Upgrading SQL Databases to next release in now much quicker, since last
                                                synchro of database in simple
                                                recovery mode is done through differential backup. The scenario is the
                                                following:  Make the instance where
                                                the next SQL Server release is already installed, the YourSqlDba mirror
                                                server.</p>
                                            <p>The day before migration, YourSqlDba will restore all selected databases
                                                for maintenance to the mirror
                                                server and keep them synchronized with log backups/restore for
                                                databases in full recovery mode.</p>
                                            <p>On migration day, when running failover, databases in simple recovery
                                                mode are going to be synchronized with
                                                a differential backup/restore, and those in full recovery mode by a
                                                last log backup restore.  The speed
                                                gain comes from the fact that no more full backup/restore needs to be
                                                performed again for the final
                                                synchronization of database in simple recovery model.</p>
                                        </li>
                                        <li>Database ownership of failed databases is set to the original owner. This
                                            is always possible, since logins are
                                            now replicated as the first step of Mirroring.FailOver</li>
                                    </ul>
                                    <h4>Bugs related to very large database name</h4>
                                    <p>When deleting old backup an not enough long variable was making a "string
                                        truncation error". This problem is now corrected.</p>

                                    <h4>Restrictions on having log backup simultaneously with other maintenance
                                        operations</h4>
                                    <p>This version removes a mechanism that exclude simultaneous Log backups with
                                        other database maintenance operations on the same database. We discovered that
                                        this requirement was lifted since SQL2005.</p>
                                    <p>To see a reliable comment about this go to <a target="_blank" href="http://www.sqlskills.com/blogs/paul/search-engine-qa-16-concurrent-log-and-full-backups/">this
                                            article</a>.</p> 
                                    <p>Because of this mechanism, YourSqlDba was sometime giving errors because
                                        excessive wait on long log backups, so this won't happen anymore.</p>

                                    <h4>SQL2012 invalid log_reuse_wait status in sys.databases make YourSqlDba use
                                        useless delays when shrinking logs</h4>
                                    <p>YourSqlDba relies on log_reuse_wait status in sys.databases to do log shrink
                                        attempts. If this status was &lt;&gt; 0 a 10 secondes delay was performed. It
                                        appears that, in SQL2012, this status is 2 most of the time (log backup), which
                                        makes this delay appears at every attempts to shrink a log's database. This
                                        status doesn't cause any error at shrink attempt, so use also include it in the
                                        list of status that doesn't prevent shrink log attempts.</p>

                                    <h4>New procedure to Install.AddOrReplaceMaintenanceTasks</h4>
                                    <p>This procedure creates or replace a default maintenance task, with a suffix of
                                        your choice in the name. It uses already existing setup for database mail.</p>
                                    <p>For more information see the full new stored procedure description at: <a href="#AddOrReplaceMaintenance">Install.AddOrReplaceMaintenance</a></p>

                                    <h4>Controlling backup name time stamping</h4>
                                    <p>By default YourSqlDba add a timestamp to backup file names. A new parameter has
                                        been added to <a href="#YourSQLDba_DoMaint">Maint.YourSqlDba_DoMaint</a> which is
                                        @TimeStampNamingForBackups. When specified with a value of 0 this parameter
                                        stops this behavior. You need to be aware that the parameters @FullBkpRetDays
                                        and @LogBkpRetDays parameters become ineffective, since total backups and log
                                        backups are overwritten at each full maintenance. Log backups still accumulate
                                        into the same log backup file during the day no matter the value of the
                                        parameter. New with version 6.2.4.</p>

                                    <h4>Login sync when full backups are done and mirroring is enabled</h4>
                                    <p>We now propagate disabled/non-disabled status when replicating accounts.</p>

                                    <h4>Easier initial setup of YourSqlDba with stored procedure
                                        Install.InitialSetupOfYourSQLDba</h4>
                                    <p>Backup directories parameters for Data and log are now optional, as they take
                                        default value specified in server properties\database settings.</p>
                                </div>

                                <div id="disabling-telemetry" class="section-block">
                                    <h3 class="block-title">Why disabling SQL Server Telemetry</h3>
                                    <p>It seems that SQL Server Error Usage and Reporting disturb normal TCP/IP
                                        connections. To disable it locate SQL
                                        Server Error and Usage Reporting in SQL Server tools, and run it. Uncheck the
                                        corresponding options and click
                                        ok. We also saw some performance fluctuations issues associated to SQL Server
                                        Telemetry activity.</p>
                                    <img class="img-fluid" src="assets/image/UsageReporting.PNG" alt="SQL Server 2017 Error and Usage Reporting" />
                                    <p>Next stops SQL Server CEIP services and set them to manual startup mode.</p>
                                    <img class="img-fluid" src="assets/image/Services.PNG" alt="Services" />
                                </div>
                            </section>

                            <section id="reference" class="doc-section">
                                <h2 class="section-title">Reference</h2>

                                <div id="automatic-maintenance" class="section-block">
                                    <h3 class="block-title">Automatic maintenance related procedures</h3>
                                    <p><a href="#YourSQLDba_DoMaint">Maint.YourSqlDba_DoMaint</a> does most of the default maintenance, and calls some of
                                        the other procedures below to do it. It have several parameter that are
                                        customized</p>
                                    <p>For most people having to manage a database server this is more than enough to
                                        get a nice maintenance plan.</p>
                                    <p>For more seasoned DBA sometimes customization of this procedure beyond the ones
                                        allowed by initial setup is needed. It can be easily be achieved by modifying
                                        its parameters in job steps. For a description of these parameters see: <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a></p>
                                    <p>Parameters can be modified from SQL Management Studio\SQL Agent\YourSqlDba...
                                        Job \Job Step</p>
                                    <p>Job schedule execution can be modified in SQL Management Studio\SQL
                                        Agent\YourSqlDba...Job \JobSchedule.</p>
                                    <p>Email configuration can be changed from SQL Management
                                        Studio\Manage\DatabaseMail.</p>
                                </div>
                                <div id="YourSQLDba_DoMaint" class="section-block">
                                    <h3 class="block-title">Maint.YourSQLDba_DoMaint</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Main procedure used to process all regular maintenance on databases. Usually called from a SQL Server Agent job step, it can also be call manually. To customize maintenance you can add tasks calling this procedure.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>Parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@oper</td>
                                                    <td>
                                                        <p>SQL Server Agent Operator. Any valid operator name is
                                                            allowed.</p>
                                                        <p>By default 'YourSQLDba_Operator'. <code>(nvarchar(200))</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@MaintJobName</td>
                                                    <td>
                                                        <p>nvarchar(200)</p>
                                                        <p>SQL Server Agent job name logged into the maintenance
                                                            history. Any valid job name is allowed. By
                                                            default
                                                            'YourSQLDba: DoInteg,DoUpdateStats,DoReorg,Full backups'.
                                                            <code>(nvarchar(200))</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@DoInteg</td>
                                                    <td>
                                                        <p>When equal to <strong>1</strong> perform Integrity tests on
                                                            selected databases.</p>
                                                        <p>By default <code>0 (Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@DoUpdStats</td>
                                                    <td>
                                                        <p>When equal to <strong>1</strong> perform Update Statistics
                                                            on selected databases.</p>
                                                        <p>By default <code>0 (Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@DoReorg</td>
                                                    <td>
                                                        <p>When equal to <strong>1</strong> perform Selective Index
                                                            Reorganization or Rebuild depending of an internal
                                                            fragmentation level found on them. When Rebuilding now
                                                            leave the original FillFactor.</p>
                                                        <p>By default <code>0 (Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@DoBackup</td>
                                                    <td>
                                                        <ul>
                                                            <li>When equal to 'F'; full database backups are performed,
                                                                plus an initial log backup.</li>
                                                            <li>When equal to 'L'; log backups are performed.</li>
                                                            <li>When equal to 'D' differential backups are done.</li>
                                                        </ul>
                                                        <p>In case of log backups, @FullBackupPath and @LogBackupPath
                                                            are ignored, the value used at last full backup
                                                            performed by <strong>Maint.YourSQLDba_DoMaint</strong> or
                                                            <strong>Maint.SaveDbOnNewFileSet</strong>, is the
                                                            one used for log backups.</p>
                                                        <p>When an empty string is supplied no backup is performed.
                                                            <code>(nvarchar(5))</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@FullBackupPath</td>
                                                    <td>
                                                        <p>Location where full database backup files (.Bak) are going
                                                            to be stored.</p>
                                                        <p><strong>(Required parameter)</strong>.</p>
                                                        <p>The UNC format is allowed.</p>
                                                        <p>Example A : <code>G:\SQL\Backups</code></p>
                                                        <p>Example B : <code>\\SQL\Backups</code></p>
                                                        <p><code>(nvarchar(512))</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@LogBackupPath</td>
                                                    <td>
                                                        <p>Location where log database backup file (.Trn) are going to
                                                            be stored.</p>
                                                        <p><strong>(Required parameter)</strong>.</p>
                                                        <p>The UNC format is allowed.</p>
                                                        <p>Example A : <code>G:\SQL\Backups</code></p>
                                                        <p>Example B : <code>\\SQL\Backups</code></p>
                                                        <p>We recommend that you use the same location as the
                                                            @FullBackupPath parameter. In this way, all of your backup
                                                            files concerning a database would be shown on the same page
                                                            in chronological order in Windows Explorer.</p>
                                                        <p>Nevertheless you can use a different partition if the disk
                                                            is full.</p>
                                                        <p><code>(nvarchar(512))</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@TimeStampNamingForBackups</td>
                                                    <td>
                                                        <p>By default YourSqlDba add a timestamp (date and time) to
                                                            backup file names. When specified with a value of 0 this
                                                            parameter stops this behavior. You need to be aware that
                                                            the parameters @FullBkpRetDays and @LogBkpRetDays
                                                            parameters become ineffective, since total backups and log
                                                            backups are overwritten at each full maintenance. Log
                                                            backups still accumulate into the same log backup file
                                                            during the day no matter the value of the parameter.
                                                            <code>(Int)</code> New with version 6.2.4.</p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@FullBkpRetDays</td>
                                                    <td>
                                                        <p>Number of days to retain the preceding full backups. Older backups are deleted from the backup directory.</p>
                                                        <p>NULL = no cleanup (default). <code>(Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@LogBkpRetDays</td>
                                                    <td>
                                                        <p>Number of days to retain the preceding transaction logs backups. Older backups are deleted from the backup directory.</p>
                                                        <p>NULL = no cleanup (default). <code>(Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@NotifyMandatoryFullDbBkpBeforeLogBkp</td>
                                                    <td>
                                                        <p>Apply to log backups only.</p>
                                                        <p>When equal to 1 an error is reported when a log backup can't be done because full database backup was never performed since database creation or since last restore.</p>
                                                        <p>When equal to 0 this error is not reported. A value of 0 applies usually well on test databases, restored from production database for which we don't really care about doing log backup.</p>
                                                        <p><code>(Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@BkpLogsOnSameFile</td>
                                                    <td>
                                                        <p>Log backups storing method.</p>
                                                        <ul>
                                                            <li>1 = Add the log backups to the same .trn backup file available since the last full backup. (default).</li>
                                                            <li>0 = Create a new backup file for each log backup.</li>
                                                        </ul>
                                                        <p><code>(Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@SpreadUpdStatRun</td>
                                                    <td>
                                                        <p>The "update statistics" for database tables is spread on the specified number of executions.</p>
                                                        <p>By default the "update statistics" is spread on a 7 executions cycle.</p>
                                                        <p>At the end of the cycle all tables in the database will have been treated.</p>
                                                        <p><code>(Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@SpreadCheckDb</td>
                                                    <td>
                                                        <p>The full DBCC CHECKDB for database spread on the specified number of executions of the main maintenance. By default the "DBCC CheckDb" is spread on a 7 executions cycle.</p>
                                                        <p>It is not the turn of a given database to be fully DBCC checked, it is checked faster with DBCC CheckDb … WITH Physical_Only and only if its page verification option is set to Checksum. If page verification option is not to "checksum", DBCC CheckDb will always without this option.</p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@ConsecutiveDaysOfFailedbackupsToPutDbOffline</td>
                                                    <td>
                                                        <p>Maximum number of consecutive days of failed full backups allowed for a database before putting that
                                                            database (Offline).</p>
                                                        <p>One successful full backup will reset to zero the counter of consecutive days of failed full backups for
                                                            that database.</p>
                                                        <p>By default = <strong>9999</strong>.</p>
                                                        <p>Last resort action to inform database administrators</p>
                                                        <p>Normally YourSQLDba send's an email to the SQL administrators when there is a full backup failure. However
                                                            if these emails stop reaching their recipients, there is a need for a last resort mechanism to inform the
                                                            administrators that the data is not protected.</p>
                                                        <p>The maintenance parameter @ConsecutiveDaysOfFailedbackupsToPutDbOffline instructs YourSQLDba to put offline
                                                            a database as a last resort to signal that full backups of a given database have failed for the specified
                                                            number of consecutives days.</p>
                                                        <p>When the full backup maintenance job is executed a counter is incremented once a day for each database for
                                                            which the full backup failed.</p>
                                                        <p>If this days counter is equal to the maximum number of consecutive failed full backup days allowed by the
                                                            parameter @ConsecutiveDaysOfFailedbackupsToPutDbOffline, the corresponding database is put offline.</p>
                                                        <p>The counter is reset to zero when the full backup succeed's for the database.</p>
                                                        <p>This feature is a last resort to attract attention of a database administrator or application users to a
                                                            potentially dangerous backup problem that can lead to data loss.</p>
                                                        <p>Note that the suspension of service can occur only at the end of the full backup maintenance job which is
                                                            usually in the middle of the night.</p>
                                                        <p>Important: Putting a database offline implies a temporary suspension of service. You may not want that to
                                                            happen. Even if no backups are available for the database.</p>
                                                        <p>You must set a value for this number of days allowed for full backup failures.</p>
                                                        <p>The number of days to choose depends on the availability level of the database administrators and of the
                                                            risk tolerance for data loss.</p>
                                                        <p>When full backups don't work, it's usually because the disk is almost full. Most of the time the log backups
                                                            continues even when the full backups didn't. This is because log backups need less disk space than full
                                                            backups.</p>
                                                        <p>The log backups allows the restoration of a database from the last available full backup.</p>
                                                        <p>Keep in mind that the greater the number of days gone without full backups or even without transaction logs
                                                            backups, the riskier it is to lose data in case of a SQL server failure.</p>
                                                        <p>You have to decide the threshold number of days of full backup failures that will cause the temporary
                                                            suspension of service for the database.</p>
                                                        <p>Here are 3 scenarios to choose from</p>
                                                        <ol>
                                                            <li>
                                                                <p>If you think that your organisation has fail safe SQL management practices to guarantee that backups
                                                                    are checked every day, you can turn off this behaviour by using a value of 9999 days:</p>
                                                                <p>@ConsecutiveDaysOfFailedbackupsToPutDbOffline= 9999</p>
                                                                <p>Specifying a great number of days for the @ConsecutiveDaysOfFailedbackupsToPutDbOffline parameter
                                                                    will effectively disable it.</p>
                                                            </li>
                                                            <li>
                                                                <p>If you think that there would not be a database administrator available every morning to verify the
                                                                    production of the full backups or to put the databases online in case of a full backup failure, you
                                                                    can use a value of 20 days :</p>
                                                                <p>@ConsecutiveDaysOfFailedbackupsToPutDbOffline= 20</p>
                                                            </li>
                                                            <li>
                                                                <p>If you think that there will always be a database administrator available every morning to verify
                                                                    the production of the full backups or to put the databases online in case of a full backup failure,
                                                                    then you can set a value of 4 days by running the following command in SQL Management Studio:</p>
                                                                <p>@ConsecutiveDaysOfFailedbackupsToPutDbOffline= 4</p>
                                                            </li>
                                                        </ol>
                                                        <p><code>(Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@MirrorServer</td>
                                                    <td>
                                                        <p>Name of the mirror SQL instance destination of the automatic restoration of the backups.</p>  
                                                        <p><strong>(Optional parameter)</strong>.</p>
                                                        <p>The <a href="#AddServer">Mirroring.AddServer</a> procedure must be executed to record this mirror SQL instance, prior to using it here in the @MirrorServer parameter.</p>
                                                        <p>Example: <code>'MirrorSQLServ\MirrorSQL2005'</code></p>
                                                        <p>NULL = don't restore on a mirror SQL instance.</p>
                                                        <p><strong>Executed tasks when @MirrorServer contains a SQL instance name:</strong></p>
                                                        <ul><li><p>Restore the backups on the mirror SQL instance.</p>
                                                                <p>The goals for this restoration are to verify the integrity of the backups, and to create duplicates of the databases in « RECOVERING » status.</p>
                                                                <p>The automatic restoration works like this: as soon as YourSQLDba creates a backup file, it restores it on the mirror SQL instance.  If this restoration fails; an error email is sent to the SQL administrator.</p>
                                                            </li>
                                                            <li>Copy the SQL logins to the mirror SQL instance.</li>
                                                        </ul>
                                                        <p><code>(Int)</code></p>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>@ReplaceSrcBkpPathToMatchingMirrorPath</td>
                                                    <td>
                                                        <p>Does a "string like" replace into backup location uses by source server to get backup location as seen from mirror server.</p>
                                                        <p>For example suppose backups are put onto a local directory</p>
                                                        <p>(here <code>F:\SqlProd\backups\</code>) and this directory is exposed to the mirror server through a share as</p>
                                                        <p>(here: <code>\\sqlProd\backups\</code>).</p>
                                                        <p>When mirror server is instructed to do a restore, it will replace into the whole file path</p>
                                                        <p><code>F:\SqlProd\backups\</code> by <code>\\sqlProd\backups\</code>.</p>
                                                        <p>This is necessary since the restore command can't be performed from its local path since while the backup file is local to the source server it isn't for the mirror. Mirror needs a different way to name the backup it want to restore. The same holds true for SQLReport location.</p>
                                                        <div class="code-block">
                                                                <pre><code class="language-sql">@ReplaceSrcBkpPathToMatchingMirrorPath = 
' 
   F:\SqlProd\backups\>\\sqlProd\backups\| 
   F:\SqlReport\backups\>\\sqlReport\backups\| 
'</code></pre>
                                                        </div>
                                                        <p>can also be written as :</p>
                                                        <div class="code-block">
                                                                <pre><code class="language-sql">@ReplaceSrcBkpPathToMatchingMirrorPath = 
' 
   F:\SqlProd\backups\>\\sqlProd\backups\|
   F:\SqlReport\backups\>\\sqlReport\backups\| 
'</code></pre>
                                                           </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                        <td>@ReplacePathsInDbFileNames</td>
                                                        <td>
                                                            <p>@ReplacePathsInDbFilenames, will allow <strong>string like</strong> replace of part of path/file names in the databases files to be restored. <strong>If omitted databases are restored to default data and log database locations.</strong></p>
                                                            <p>For example suppose that:</p>
                                                            <p>source Db files from SQLProd are located under</p>
                                                            <p><code>D:\SqlProd\Data</code> for data and</p>
                                                            <p><code>E:\SqlProd\Logs</code> for logs and</p>
                                                            <p>source Db files from SQLReport are located under <code>D:\SqlReport\Data</code> for data</p>
                                                            <p>And <code>E:\SqlReport\Logs</code> for logs.</p>
                                                            <p> If you want to put them on the mirror server on different disks and subdirectories  let's say</p>
                                                            <p><code>G:\Mirror\SqlProd\Data</code> And <code>H:\Mirror\SQLProd\Logs</code> for SQLProd and</p>
                                                            <p><code>G:\Mirror\SQLReport\Data</code> And <code>H:\Mirror\SQLReport\Logs</code> for SQLReport,</p>  
                                                            <p>@ReplacePathsInDbFileNames will have to be specified this way:</p>
                                                            <div class="code-block">
                                                                    <pre><code class="language-sql">@ReplacePathsInDbFileNames = 
   ' 
   D:\>G:\SqlMirror\| 
   E:\>H:\SqlMirror\| 
   '</code></pre>
                                                            </div>
                                                            <p>Or</p>
                                                            <div class="code-block">
                                                                <pre><code class="language-sql">@ReplacePathsInDbFileNames = 'D:\>G:\SqlMirror\|E:\>H:\SqlMirror\|'</code></pre>
                                                            </div>
                                                            <p>To restore to same location (let's say they are under D and E drive) use:</p>
                                                            <div class="code-block">
                                                                    <pre><code class="language-sql">@ReplacePathsInDbFileNames =  
   ' 
   D:>D:| 
   E:>E:| 
   '</code></pre>
                                                            </div>
                                                        </td>
                                                </tr>
                                                <tr>
                                                   <td>@IncDb</td>
                                                   <td>
                                                      <p>One database to select, or many using a database list, or many more using a wildcard database list.  When left empty, all databases are selected for maintenance.<p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>The databases names in the list, can include wildcard characters from the "Select" instruction "like" clause.</p>
                                                      <table class="table table-bordered">
                                                         <thead>
                                                            <tr>
                                                               <th>Wildcard character</th>
                                                               <th>Description</th>
                                                               <th>Example</th>
                                                            </tr>
                                                         </thead>
                                                         <tbody>
                                                            <tr>
                                                               <td>%</td>
                                                               <td>Any string of zero or more characters.</td>
                                                               <td>'%base%' selects all databases names that contains the word "base" anywhere in the database name.</td>
                                                            </tr>
                                                            <tr>
                                                               <td>_ (underscore)</td>
                                                               <td>Any single character.</td>
                                                               <td>'an_' selects any three-letter database names beginning with the letters "an", like "An1" or "An9" or "AnF".</td>
                                                            </tr>
                                                            <tr>
                                                               <td>[0-9]</td>
                                                               <td>Any single character between 0 and 9.</td>
                                                               <td>'base[5-9]' selects any five-letter database names beginning with the letters "base", and followed by a number between 5 and 9, like « base5 » or « base9 ».</td>
                                                            </tr>
                                                            <tr>
                                                               <td>[_]</td>
                                                               <td>The underscore character.</td>
                                                               <td>'%[_]test' selects any database names ending with the characters "_test". The underscore between brackets is interpreted as a character instead of a wildcard character. It is the same behaviour with '%', ']' and '['.</td>
                                                            </tr>
                                                         </tbody>
                                                      </table>
                                                      <p><code>(Int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                   <td>@ExcDb</td>
                                                   <td>
                                                      <p>One database to exclude, or many using a database list, or many more using a wildcard database list.<p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>When left empty, no databases are excluded for maintenance. If specified, exclusion processing applies to resulting database list selected by @IncDb processing, which means all databases if @IncDb is an empty string.</p>
                                                      <p><code>(Int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                   <td>@ExcDbFromPolicy_CheckFullRecoveryModel</td>
                                                   <td>
                                                      <p>Database list to be excluded from the policy check of the full recovery model.<p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>If the parameter is absent; no database is excluded from the policy check.</p>
                                                      <p>Maint.YourSqlDba_DoMaint, will send an error email when a database is in <strong>Simple Recovery</strong> model and this database is not listed in the <strong>@ExcDbFromPolicy_CheckFullRecoveryModel</strong> parameter.</p>
                                                      <p>Each database name filter must be on its own line between the quote pair.</p>
                                                      <p>The databases name filter list can include wildcard characters as describe in the above <strong>@IncDb</strong> parameter.</p>
                                                      <p><code>(Int)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                   <h5>Samples</h5>
                                   <h6>A. Perform full backups and complete maintenance on all user databases</h6>
                                   <p>The following example performs full backups on all user databases.  It automatically excludes the system databases.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.YourSQLDba_DoMaint
 
  @oper = 'YourSQLDba_Operator'  -- operator used to email report  
  -- job name displayed in email report  
, @MaintJobName = 'YourSQLDba: DoInteg,DoUpdateStats,DoReorg,Full backups'  
                    
, @DoInteg = 1          -- performs database integrity test  
, @DoUpdStats = 1       -- performs update statistics  
, @DoReorg = 1          -- performs reorganize, rebuild     
, @DoBackup = 'F'       -- performs full backups and initial log backups  
 
 
, @FullBackupPath = 'G:\Sql\Backups\'    -- full backup path destination  
 
, @LogBackupPath = 'G:\Sql\Backups\'     -- log backup path destination    
 
 
, @FullBkpRetDays = 0          -- Flush all previous database backups  
, @LogBkpRetDays = 7           -- Flush log backups older than (7) days  
, @SpreadUpdStatRun = 7        -- Spreads Update Stats over 7 executions  
 
  -- Maximum number of consecutive days of failed full backups allowed  
  -- for a database before putting that database (Offline).  
, @ConsecutiveDaysOfFailedbackupsToPutDbOffline= 9999  
 
, @MirrorServer = 'MirrorSQLServ\SQL'  
 
, @IncDb =     -- Each database inclusion filter must be  
               -- on its own line between the following quote pair  
'  
'  
, @ExcDb =     -- Each database exclusion filter must be  
               -- on its own line between the following quote pair  
'  
'  
 
, @ExcDbFromPolicy_CheckFullRecoveryModel =     -- Each database exclusion filter must be  
                                                -- on its own line between the following quote pair  
'  
'</code></pre>
                                   </div>
                                   <h6>B. Perform full backups on some user databases</h6>
                                   <p>The following example performs full backups on databases which name starts with "Sales" but exclude of this result those which finish with "Temp" plus one or 2 digits.</p>
                                   <p>For example Databases Sales, SalesGeorge, SalesTemp1, SalesTemp25 are first selected by @IncDb parameter, but SalesTemp1 and SalesTemp25 are excluded by @ExcDb.  So the final result is that maintenance is going to apply only to Sales, SalesGeorge.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.YourSQLDba_DoMaint  
 
  @oper = 'YourSQLDba_Operator'              -- operator used to email report  
, @MaintJobName = 'YourSQLDba: Sales Full backups'  -- job name displayed in email report  
, @DoBackup = 'F'                            -- performs full backups and initial log backups  
, @FullBackupPath = 'G:\Sql\Backups\'     -- full backup path destination  
, @LogBackupPath = 'G:\Sql\Backups\'      -- log backup path destination    
 
, @FullBkpRetDays = NULL         -- No cleanup of the full backups  
, @LogBkpRetDays = 7             -- Flush log backups older than (7) days  
 
, @IncDb =      -- Each database inclusion filter must be on its own line  
                -- between the following quote pair  
'  
Sales%  
'  
, @ExcDb =      -- Exclude databases that ends with "temp" followed by  
                -- a single digit, or a double digit  
'  
%temp[0-9]  
%temp[0-9][0-9]  
'</code></pre>
                                   </div>
                                   <h6>C. Perform only log backups on all user databases</h6>
                                   <p>The following example performs only the log backups on all databases.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.YourSQLDba_DoMaint  
 
  @oper = 'YourSQLDba_Operator'              -- operator used to email report  
, @MaintJobName = 'YourSQLDba: Log backups'  -- job name displayed in email report  
, @DoBackup = 'L'                            -- performs log backups only  
, @FullBackupPath = 'G:\Sql\Backups\'     -- full backup path destination  
, @LogBackupPath = 'G:\Sql\Backups\'      -- log backup path destination    
, @IncDb =      -- Each database inclusion filter must be on its own line  
                -- between the following quote pair  
'  
'  
, @ExcDb =      -- Each database exclusion filter must be on its own line  
                -- between the following quote pair  
'  
'</code></pre>
                                   </div>
                                </div>
                                <div id="installation-related-procedures" class="section-block">
                                    <h3 class="block-title">Installation related procedures</h3>
                                    <p><a href="#InitialSetupOfYourSQLDba">Install.InitialSetupOfYourSQLDba</a> is the mean by which Sql Agent jobs and email reporting are configured.</p>
                                    <p><a href="#PrintVersionInfo">Install.PrintVersionInfo</a> print the current YourSqlDba version.</p>
                                    <p><a href="#AddOrReplaceMaintenance">Install.AddOrReplaceMaintenance</a> can be used to add/replace a maintenance task with its default parameter.  If the @jobNameSuffix parameter, appended to the default YourSqlDba job names makes a match to an existing job name, it is replaced, otherwise it is created.  Email reporting stays the same as the one configured by Install.InitialSetupOfYourSqlDba.</p>
                                    <p><a href="#UpdateMaintenanceTasksParam">Install.UpdateMaintenanceTasksParam</a> can be used as a quick search and replace of YourSqlDba parameters tasks if you customized default install to have many more jobs than the usual two SQL Agent single step jobs.</p>
                                </div>
                                <div id="InitialSetupOfYourSQLDba" class="section-block">
                                    <h3 class="block-title">Install.InitialSetupOfYourSQLDba</h3>
                                    <p><strong>Go back to</strong> <a href="#quickstart-section">YourSqlDba QuickStart</a></p>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <ul>
                                                <li>Set up Database Mail to add Database Mail Profile and Database mail Account. Database mail account name is defined using server and instance name (if not a default instance), and supplied mail server name through the supplied</li>
                                                <li>Set SQL Server Agent to use Database Mail Profile, Set operator for maintenance email with the supplied address.</li>
                                                <li>Setup two SQL Agent Tasks to runs Maint.YourSQLDba_DoMaint maintenance with default parameters, at the exception of backup path parameters which are supplied through this procedure.</li>
                                             </ul>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Install.InitialSetupOfYourSQLDba   
  @email = 'myAdmin@myDomain.com'              -- Email recipients (or distribution list)   
, @SmtpMailServer = 'myMailServer'             -- Mail server that accept SMTP mail   
, @ConsecutiveDaysOfFailedBackupsToPutDbOffline = 3 -- for part time DBAs...</code></pre>
                                   </div>
                                   <p>OR if you want to specify a different location for backups than the default one specified in server properties / database settings </p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Install.InitialSetupOfYourSQLDba  
  @FullBackupPath = 'D:\Sql\Backups'       -- full backup path destination  
, @LogBackupPath = 'D:\Sql\Backups'        -- log backup path destination  
, @email = 'myAdmin@myDomain.com'              -- Email recipients (or distribution list)  
, @SmtpMailServer = 'myMailServer'             -- Mail server that accept SMTP mail  
 
, @ConsecutiveDaysOfFailedBackupsToPutDbOffline = 9999    
                           -- Maximum number of consecutive days of failed full backups allowed  
                           -- for a database before putting that database (Offline)</code></pre>
                                   </div>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@FullBackupPath</td>
                                                    <td>
                                                      <p><strong>Optional</strong>.</p> 
                                                      <p>Location where full database backup file (.Bak) are going to be stored. UNC are allowed.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                      <p>Default : value specified in server properties\database settings</p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@LogBackupPath</td>
                                                    <td>
                                                      <p><strong>Optional</strong>.</p> 
                                                      <p>Location where log database backup file (.Trn) are going to be stored. UNC are allowed.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                      <p>Default : value specified in server properties\database settings</p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@email</td>
                                                    <td>
                                                      <p>Email recipients (or distribution list).  Each item must be separated by semicolon; Limited to 100 characters despite wider parameters, because SQL Server Agent limits operator definition to 100 characters.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@SmtpMailServer</td>
                                                    <td>
                                                      <p>Mail server that will be authorized to accept SMTP mail from your SQL Server machine.  By default authentication is set to anonymous, but it can modified later in database mail account generated as an account of the generated <strong>YourSQLDba_MailProfile</strong>.</p>
                                                      <p><code>(nvarchar(128))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@ConsecutiveDaysOfFailedbackupsToPutDbOffline</td>
                                                    <td>
                                                      <p>Maximum number of consecutive days of failed full backups allowed for a database before putting that database (Offline).</p>
                                                      <p>One successful full backup will reset to zero the counter of consecutive days of failed full backups for that database.</p>
                                                      <p>Last resort action to inform database administrators</p>
                                                      <p>Normally YourSQLDba send's an email to the SQL administrators when there is a full backup failure. However if these emails stop reaching their recipients, there is a need for a last resort mechanism to inform the administrators that the data is not protected.</p>
                                                      <p>The maintenance parameter <strong>@ConsecutiveDaysOfFailedBackupsToPutDbOffline</strong> instructs YourSQLDba to put offline a database as a last resort to signal that full backups of a given database have failed for the specified number of consecutives days.</p>
                                                      <p>When the full backup maintenance job is executed a counter is incremented once a day for each database for which the full backup failed.</p>
                                                      <p>If this days counter is equal to the maximum number of consecutive failed full backup days allowed by the parameter <strong>@ConsecutiveDaysOfFailedBackupsToPutDbOffline</strong>, the corresponding database is put offline.</p>
                                                      <p>The counter is reset to zero when the full backkup succeed's for the database.</p>
                                                      <p>This feature is a <strong>last resort</strong> to attract attention of a database administrator or application users to a potentially dangerous backup problem that can lead to data loss.</p>
                                                      <p>Note that the suspension of service can occur only at the end of the full backup maintenance job which is usually in the middle of the night.</p>
                                                      <p><strong>Important:</strong> Putting a database offline implies a temporary suspension of service. You may not want that to happen. Even if no backups are available for the database.</p>
                                                      <p>You must set a value for this number of days allowed for full backup failures.</p>
                                                      <p>The number of days to choose depends on the availability level of the database administrators and of the risk tolerance for data loss.</p>
                                                      <p>When full backups don't work, it's usually because the disk is almost full. Most of the time the log backups continues even when the full backups didn't. This is because log backups need less disk space than full backups.</p>
                                                      <p>The log backups allows the restoration of a database from the last available full backup.</p>
                                                      <p>Keep in mind that the greater the number of days gone without full backups or even without transaction logs backups, the riskier it is to lose data in case of a SQL server failure.</p>
                                                      <p>You have to decide the threshold number of days of full backup failures that will cause the temporary suspension of service for the database.</p>
                                                      <h5>Here are 3 scenarios to choose from</h5>
                                                      <ol>
                                                         <li>
                                                            <p>If you think that your organisation has fail safe SQL management practices to guarantee that backups are checked every day, you can turn off this behaviour by using a value of 9999 days:</p>
                                                            <p><code>@ConsecutiveDaysOfFailedbackupsToPutDbOffline = 9999</code></p>
                                                            <p>Specifying a great number of days for the @ConsecutiveDaysOfFailedbackupsToPutDbOfflineparameter will effectively disable it.</p>
                                                         </li>
                                                         <li>
                                                            <p>If you think that there would not be a database administrator available every morning to verify the production of the full backups or to put the databases online in case of a full backup failure, you can use a value of 20 days:</p>
                                                            <p><code>@ConsecutiveDaysOfFailedbackupsToPutDbOffline = 20</code></p>
                                                         </li>
                                                         <li>
                                                            <p>If you think that there will always be a database administrator available every morning to verify the production of the full backups or to put the databases online in case of a full backup failure, then you can set a value of 4 days by running the following command in SQL Management Studio:</p>
                                                            <p><code>@ConsecutiveDaysOfFailedbackupsToPutDbOffline= 4</code></p>
                                                         </li>
                                                      </ol>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@FullBkExt</td>
                                                    <td>
                                                      <p>Optional : By default full backup have ".bak" extension</p>
                                                      <p><code>(nvarchar(7))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@LogBkExt</td>
                                                    <td>
                                                      <p>Optional : By default log backup have ".trn" extension</p>
                                                      <p><code>(nvarchar(7))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@sourceEmail</td>
                                                    <td>
                                                      <p>Optional : Change the sender name to the sender of your choice.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@emailServerAccount</td>
                                                    <td>
                                                      <p>Optional: If basic authentication is required, email server account can be specified.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@emailServerPassword</td>
                                                    <td>
                                                      <p>Optional: If basic authentication is required, email server account password can be specified.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="PrintVersionInfo" class="section-block">
                                    <h3 class="block-title">Install.PrintVersionInfo</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Prints the YourSQLDba version.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Install.PrintVersionInfo</code></pre>
                                   </div>
                                </div>
                                <div id="AddOrReplaceMaintenance" class="section-block">
                                    <h3 class="block-title">Install.AddOrReplaceMaintenance</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <ul>
                                                <li>Recreates or add a new set of full/log maintenance.</li>
                                                <li>Setup two SQL Agent Tasks to runs <strong>Maint.YourSQLDba_DoMaint</strong> maintenance with default parameters, at the exception of backup path parameters which are supplied through this procedure.</li>
                                            </ul>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Install.AddOrReplaceMaintenance 
 
  @JobNameSuffix = '_JobForNeedXXX'       -- full backup path    
, @FullBackupPath = 'G:\Sql\Backups'       -- full backup path destination  
, @LogBackupPath = 'G:\Sql\Backups'        -- log backup path destination  
, @ConsecutiveDaysOfFailedbackupsToPutDbOffline = 9999    
                           -- Maximum number of consecutive days of failed full backups allowed  
                           -- for a database before putting that database (Offline).</code></pre>
                                   </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@JobNameSuffix</td>
                                                    <td>
                                                      <p>Add this suffix to default job names, YourSQLDba_FullBackups_And_Maintenance and YourSQLDba_LogBackups.  If a name of a job exists with the same suffix, replace the job, otherwise creates it.</p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@FullBackupPath</td>
                                                    <td>
                                                      <p>Location where full database backup  file (.Bak) are going to be stored.  UNC are allowed.</p> 
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@LogBackupPath</td>
                                                    <td>
                                                      <p>Location where log database backup  file (.Trn) are going to be stored.  UNC are allowed.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@ConsecutiveDaysOfFailedbackupsToPutDbOffline</td>
                                                    <td>
                                                      <p>Maximum number of consecutive days of failed full backups allowed for a database before putting that database (Offline).</p>
                                                      <p>One successful full backup will reset to zero the counter of consecutive days of failed full backups for that database.</p>
                                                      <p>Last resort action to inform database administrators</p>
                                                      <p>Normally YourSQLDba send's an email to the SQL administrators when there is a full backup failure. However if these emails stop reaching their recipients, there is a need for a last resort mechanism to inform the administrators that the data is not protected.</p>
                                                      <p>The maintenance parameter <strong>@ConsecutiveDaysOfFailedBackupsToPutDbOffline</strong> instructs YourSQLDba to put offline a database as a last resort to signal that full backups of a given database have failed for the specified number of consecutives days.</p>
                                                      <p>When the full backup maintenance job is executed a counter is incremented once a day for each database for which the full backup failed.</p>
                                                      <p>If this days counter is equal to the maximum number of consecutive failed full backup days allowed by the parameter <strong>@ConsecutiveDaysOfFailedBackupsToPutDbOffline</strong>, the corresponding database is put offline.</p>
                                                      <p>The counter is reset to zero when the full backkup succeed's for the database.</p>
                                                      <p>This feature is a <strong>last resort</strong> to attract attention of a database administrator or application users to a potentially dangerous backup problem that can lead to data loss.</p>
                                                      <p>Note that the suspension of service can occur only at the end of the full backup maintenance job which is usually in the middle of the night.</p>
                                                      <p><strong>Important:</strong> Putting a database offline implies a temporary suspension of service. You may not want that to happen. Even if no backups are available for the database.</p>
                                                      <p>You must set a value for this number of days allowed for full backup failures.</p>
                                                      <p>The number of days to choose depends on the availability level of the database administrators and of the risk tolerance for data loss.</p>
                                                      <p>When full backups don't work, it's usually because the disk is almost full. Most of the time the log backups continues even when the full backups didn't. This is because log backups need less disk space than full backups.</p>
                                                      <p>The log backups allows the restoration of a database from the last available full backup.</p>
                                                      <p>Keep in mind that the greater the number of days gone without full backups or even without transaction logs backups, the riskier it is to lose data in case of a SQL server failure.</p>
                                                      <p>You have to decide the threshold number of days of full backup failures that will cause the temporary suspension of service for the database.</p>
                                                      <h5>Here are 3 scenarios to choose from</h5>
                                                      <ol>
                                                         <li>
                                                            <p>If you think that your organisation has fail safe SQL management practices to guarantee that backups are checked every day, you can turn off this behaviour by using a value of 9999 days:</p>
                                                            <p><code>@ConsecutiveDaysOfFailedbackupsToPutDbOffline = 9999</code></p>
                                                            <p>Specifying a great number of days for the @ConsecutiveDaysOfFailedbackupsToPutDbOfflineparameter will effectively disable it.</p>
                                                         </li>
                                                         <li>
                                                            <p>If you think that there would not be a database administrator available every morning to verify the production of the full backups or to put the databases online in case of a full backup failure, you can use a value of 20 days:</p>
                                                            <p><code>@ConsecutiveDaysOfFailedbackupsToPutDbOffline = 20</code></p>
                                                         </li>
                                                         <li>
                                                            <p>If you think that there will always be a database administrator available every morning to verify the production of the full backups or to put the databases online in case of a full backup failure, then you can set a value of 4 days by running the following command in SQL Management Studio:</p>
                                                            <p><code>@ConsecutiveDaysOfFailedbackupsToPutDbOffline= 4</code></p>
                                                         </li>
                                                      </ol>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="UpdateMaintenanceTasksParam" class="section-block">
                                    <h3 class="block-title">Install.UpdateMaintenanceTasksParam</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Replaces the value of a parameter in all SQL Server Agent jobs which executes the <strong>Maint.YourSQLDba_DoMaint</strong> procedure. Intended for people who have many many YourSqlDba tasks. Usually it is easier to go directly on the single task of one of the two SQL Server Agent job.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@paramName</td>
                                                    <td>
                                                      <p><code>Sysname</code></p>
                                                      <p>Parameter name for which the value must be changed.</p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@paramValue</td>
                                                    <td>
                                                      <p><code>(nvarchar(max))</code></p>
                                                      <p>New value for the parameter.</p> 
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <h6>A. Replacing the value for the @ConsecutiveFailedbackupsDaysToPutDbOffline parameter</h6>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YOURSQLDBA.Install.UpdateMaintenanceTasksParam  
  -- Parameter name for which the value must be changed.  
  @paramName = '@ConsecutiveFailedbackupsDaysToPutDbOffline'    
  -- New value for the parameter.  
, @paramValue = '20'</code></pre>
                                   </div>
                                   <h6>B. Replacing the value for the @LogBkpRetDays parameter</h6>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YOURSQLDBA.Install.UpdateMaintenanceTasksParam  
  @paramName = '@LogBkpRetDays'    -- Parameter name for which the value must be changed.  
, @paramValue = '14'               -- New value for the parameter.</code></pre>
                                   </div>
                                </div>
                                <div id="database-recovery-with-yoursqldba" class="section-block">
                                    <h3 class="block-title">Database recovery with YourSqlDba</h3>
                                    <h4>Database offline or in emergency mode.</h4>
                                   <p>There are two causes possible to that and what to do.</p>
                                   <ol>
                                      <li>
                                          <p>Sql Server put the database offline by itself.</p>
                                          <ol>
                                             <li>Finding database in offline mode is obviously a serious matter.  A offline database can be in this state because one of the drive onto which one of it file it is stored is not accessible.</li>
                                             <li>Finding a database in emergency mode is a more serious thing.  The database internal structures have few or too much inconsistencies that commend to stop them using it now, a do a recovery before data loss could become more severe.</li>
                                          </ol>
                                      </li>
                                      <li>
                                          <p>YourSqlDba put the database offline because one of the following reasons.</p>
                                          <ol>
                                             <li>When YourSqlDba puts a database in emergency mode it does it for the same reason that Sql Server would have done it.  It just detects faster integrity problems which increases a lot your chances of recovery of theses database and their data.  YourSqlDba detects internal inconsistencies by the use of the DBCC CheckDb T-SQL command.  This database can be recovered easily by using a full database backup of previous day onto which maintenance succeed without putting the database in emergency mode.  Then restore the database using this backup file and all log backups files in between.</li>
                                             <li>
                                                <p>When a database is put offline by YourSqlDba, this is because you specified at initial setup of YourSqlDba to do it so if no successful backups of that database where done after the specified number of days specified.  Did you notice that you were no longer receiving YourSqlDba email alerts or are you just ignoring them?  Don't panic! Bring them online by right clicking on database to get contextual menu and find the option to bring it online. A faster way to do it if you have many is to run</p>
                                                <p><a href="#BringBackOnlineAllBdInEmergencyOrOffline">Maint.BringBackOnlineAllBdInEmergencyOrOffline</a>. Next find out why it happened by displaying backup errors with <a href="#ShowHistoryErrors">Maint.ShowHistoryErrors</a>.  Solve the problem (most often a lack of backup space, or an inccessible or lack of privileges to backup destination), and once ok performs <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a>. Last find out why email messages alert from YourSqlDba doesn't reach you. Check anti-spam, diagnose database mail with <a href="#DiagDbMail">Maint.DiagDbMail</a>.</p>
                                             </li>
                                          </ol>
                                      </li>
                                   </ol>
                                   <h4>Database restore</h4>
                                   <p>YourSqlDba does adequate backups and save log backup history by saving regularly MSDB , every time it performs log backups.</p>
                                   <p>YourSqlDba use a much better naming pattern for backup files and log history backup details to know which files where used and when every backup was performed.</p>
                                   <p>SQL Server management Studio display this history when you want to do a restore.  All parameters are there by default to perform a complete restore.  This is very easy to select which backup, and it appropriates log backups and do a point-in-time recovery for a given database.</p>
                                   <p>If you loose all databases your need to recover first MASTER.  Get some help if you have no clue to do that.</p>
                                   <p>Rerun YourSqlDba script to re-create YoursqlDba database.</p>
                                   <p>Once done we suggest to restore MSDB database which contains backup history.  I suggest to stop SQL Agent before because it is likely to open a connection to MSDB which prevents restoring it easily.</p>
                                   <p>Once done we suggest to restore MSDB database which contains backup history.  I suggest to stop SQL Agent before because it is likely to open a connection to MSDB which prevents restoring it easily.</p>
                                   <p>You can use <a href="#RestoreDb">Maint.RestoreDb</a> to restore it, if you are not familiar with SQL Management Studio to restore it without backup history.  However if you look carefully to SQL Management Studio restore dialog, you'll see on the main screen how to select a backup file. Choose whatever method with which you are comfortable.</p>
                                   <p>From there is starts to be easier.  You get backup history for every database.  From them is it really easy to restore a database, all is there by default, just click ok.</p>
                                </div>
                                <div id="BringBackOnlineAllBdInEmergencyOrOffline" class="section-block">
                                   <h3 class="block-title">Maint.BringBackOnlineAllBdInEmergencyOrOffline</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Bring back online quickly all databases that are offline or in emergency mode.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                             <p>YourSQLDba may put a database in emergency mode when an integrity error is detected.</p>
                                             <p>YourSQLDba may put a database offline as a last resort to signal that full backups of that database have failed for the specified number of consecutives days.</p>
                                             <p>When the source of the problem is resolved, the SQL administrators can bring back online all databases by executing the <strong>Maint.BringBackOnlineAllBdInEmergencyOrOffline</strong> procedure.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.BringBackOnlineAllBdInEmergencyOrOffline</code></pre>
                                   </div>
                                </div>
                                <div id="RestoreDb" class="section-block">
                                   <h3 class="block-title">Maint.RestoreDb</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Restore database from a backup copy made by <a href="#SaveDbCopyOnly">Maint.SaveDbCopyOnly</a>.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                            <p>@ReplaceExistingDb parameter is equivalent of With replace option of T-SQL Restore command. Contrary to the Restore command, which accept restoring a database from one of its backups, even it the replace option is missing, here @ReplaceExistingDb set to 0 forbids overwriting and existing database. To backup user must be member of db_backupOperator or db_owner, and to restore he must be member of db_creator server role.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@TargetDb</td>
                                                    <td>
                                                      <p>Name of the destination database to create.  It must not already exists.</p>
                                                      <p><code>(sysname)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@PathAndFilename</td>
                                                    <td>
                                                      <p>Full path and file name of the backup file.</p> 
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@ReplaceExistingDb</td>
                                                    <td>
                                                      <p>Set to 1 to overwrite existing database.  When set to 0 and database exists, no restore is performed.</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.RestoreDb  
  @TargetDb = 'SalesDb'  -- name of the database  
-- path and file name of the backup 
, @PathAndFilename = 'g:\sql\backups\SalesDbBeforeMonthlyReports.bak'  
-- specify to restore over an existing database  
-- or a database for which SQL wants you to save log tail before restoring,  
-- if you don't care about existing unsaved log transactions                        
, @ReplaceExistingDb = 0</code></pre>
                                   </div>
                                </div>
                                <div id="manual-backup-restore-procedures" class="section-block">
                                   <h3 class="block-title">Manual backup/restore procedures</h3>
                                   <p>Sometimes as a DBA or occasional DBA, you need to a complete full backup of a database before an important operation, to ensure that you are going to be able to restore in case of failure.</p>
                                   <p>If your database <strong>is in complete recovery mode</strong> (see you database properties\options\recovery mode) the easiest thing to do is to start log backup job from SQL Agent\Job\YourSQLDba_LogBackups.  Usually log backups are quick, and it does it for all databases.  At the end of the day log backup files won't be bigger, because sooner or later, transactions in log backup are going to be flush to log backup files. Just after log backup, note the time. If a restore is need you can restore at the precise point-in-time using SQL Management Studio\Databases\YouDatabase\Tasks\Restore and click on Specific Date and Time.  This allows to specify at which time the database and its transactions since last full backup are going to be reapplied.</p>
                                   <p>If your database isn't in complete recovery mode, the easiest way to a backup is to run <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a>. If you don't mind putting the new backup with others in their usual location, just specify database name as unique parameter to the stored procedure.  YourSqlDba gives a new backup name that reflects in its name the backup time, so it won't erase existing full backup of the database. By default it will use the last backup location of the last backup. If you want another location see parameters of <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a>.</p>
                                   <p>If your goal is to duplicate a database, for example to run tests against a copy of a production database use <a href="#DuplicateDb">Maint.DuplicateDb</a>.</p>
                                   <p>You can use <a href="#DeleteOldBackups">Maint.DeleteOldBackups</a> to deletes backup not handled by automatic maintenance. By default backup files of databases not selected by maintenance are cleanup accordingly to a specific parameter of procedure <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a>.This procedure provides some parameters to handle other databases.</p>
                                </div>
                                <div id="SaveDbOnNewFileSet" class="section-block">
                                   <h3 class="block-title">Maint.SaveDbOnNewFileSet</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                               <p>Start backups for a given database with a new file set (the pair full backup file and log backup files for a database).</p>
                                               <p>This new file set is going to be the reference set for log backups, which will continue to append log backups to the same file until the next <a href="#YourSQLDba_DoMaint">YourSQLDba.Maint.YourSQLDba_DoMaint</a> run. In that run, the log backup path location will reset to YourSQLDba_DoMaint backup path locations.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DbName</td>
                                                    <td>
                                                      <p>Database name to backup.</p>
                                                      <p><code>(nvarchar(128))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@FullBackupPath</td>
                                                    <td>
                                                      <p>Location where the full database backup file (.Bak) will be stored. UNC are allowed.</p> 
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@LogBackupPath</td>
                                                    <td>
                                                      <p>Location where the log database backup file (.Trn) will be stored.  UNC are allowed.</p>
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@oper</td>
                                                    <td>
                                                      <p>Operator name, by default YourSQLDba_Operator.  Any user defined SQL Server Agent Operator is allowed.</p>
                                                      <p><code>(nvarchar(128))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@MirrorServer</td>
                                                    <td>
                                                      <p>Name of a mirror SQL instance destination to automatically restore the backup.</p>
                                                      <p><strong>Optional</strong>.</p>
                                                      <p>Name of a mirror SQL instance destination to automatically restore the backup.</p>
                                                      <p>The <a href="#AddServer">Mirroring.AddServer</a> procedure must be executed to record this mirror SQL instance, prior to using it here in the <strong>@MirrorServer</strong> parameter.</p>
                                                      <p>Example: <code>'MirrorSQLServ\SQL'</code></p>
                                                      <p>All the SQL logins will be copied from the source instance to the mirror SQL instance. NULL = use the last mirror SQL instance used by the global maintenance.</p>
                                                      <p><code>(sysname)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.SaveDbOnNewFileSet  
  @DbName = 'DATABASE'   -- Database name to backup.  
-- Location where the full database backup file (.Bak) will be stored. 
, @FullBackupPath = 'G:\Sql2005Backups\'  
-- Location where log database backup file (.Trn) will be stored.  
, @LogBackupPath = 'G:\Sql2005Backups\'   
-- Operator name, by default YourSQLDba_Operator.  
, @oper = 'YourSQLDba_Operator'  
, @MirrorServer='SqlM\Sales'</code></pre>
                                   </div>
                                </div>
                                <div id="SaveDbCopyOnly" class="section-block">
                                   <h3 class="block-title">Maint.SaveDbCopyOnly</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Make a backup copy without disturbing log backups performed with regular log backup maintenance. Use the special With copy_only parameter, to avoid disturbing backup log sequence and database LSN number.  These types of backups are not recorded to the backup log history and can't be restored from SQL Management Studio graphical interface for database restore. The must be restore with the supplied <a href="#RestoreDb">Maint.RestoreDb</a> procedure.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                            <p>The procedure checks if the call has at least rights to backup the database.  Being member of db_backupOperator fix database role is the minimal rights set required.  It is convenient because it doesn't allow end user other access to the database (unless some rights are added to him through public database role).  This limit allow to put credentials into a script that calls Sqlcmd without the risk of exposing database content or giving more access to this user.  Being constrained to put a database  backup to a designed location accessible only from the database engine avoid disclosure of information.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DbName</td>
                                                    <td>
                                                      <p>Database name to backup.</p>
                                                      <p><code>(sysname)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@PathAndFilename</td>
                                                    <td>
                                                      <p>Full path and file name of the backup file.</p> 
                                                      <p><code>(nvarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@errorN</td>
                                                    <td>
                                                      <p>Output error code for batches</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.SaveDbCopyOnly  
  @DbName = 'SalesDb'        -- name of the database  
, @PathAndFilename = 'g:\sql\backups\SalesDbBeforeMonthlyReports.bak'</code></pre>
                                   </div>
                                </div>
                                <div id="DuplicateDb" class="section-block">
                                   <h3 class="block-title">Maint.DuplicateDb</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Creates a duplicate of an existing database. Target Db must not exists.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@sourceDb</td>
                                                    <td>
                                                      <p>Name of the source database to duplicate.</p>
                                                      <p><code>(sysname)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@TargetDb</td>
                                                    <td>
                                                      <p>Name of the destination database to create. It must not already exists.</p> 
                                                      <p><code>(sysname)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@PathAndFilename</td>
                                                    <td>
                                                      <p>Full path and file name of the backup file.</p>
                                                      <p><code>(NVarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@KeepBackupFile</td>
                                                    <td>
                                                      <p>When set to 0, backup file is removed after restore.</p>
                                                      <p><code>(bit)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.DuplicateDb 
  @sourceDb = 'Sales' -- Source database 
, @TargetDb = 'SalesBeforeMonthlyReport' -- Target database 
, @PathAndFilename = 'g:\sql\backups\SalesBeforeMonthlyReports.bak' -- .bak 
, @KeepBackupFile = 0   -- don't keep backup file once restore is done</code></pre>
                                   </div>
                                </div>
                                <div id="DeleteOldBackups" class="section-block">
                                   <h3 class="block-title">Maint.DeleteOldBackups</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Delete old backup files.</p>
                                            <p>This procedure is usually executed from a global maintenance job in SQL Server Agent, but it can be executed alone in its own job in SQL Server Agent, or in a SQL Server Management Studio query window.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@oper</td>
                                                    <td>
                                                      <p>SQL Server Agent Operator.  Any valid operator name is allowed.</p>
                                                      <p>By default 'YourSQLDba_Operator'.</p>
                                                      <p><code>(NVarchar(200))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@MaintJobName</td>
                                                    <td>
                                                      <p>SQL Server Agent job name logged into the maintenance history. Any valid job name is allowed.</p>
                                                      <p>By default 'YourSQLDba: DoInteg,DoUpdateStats,DoReorg,Full backups'.</p> 
                                                      <p><code>(NVarchar(200))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@Path</td>
                                                    <td>
                                                      <p>Full path of the backup directory. <strong>Mandatory</strong>.</p>
                                                      <p>A UNC path is allowed.</p>
                                                      <p>Example A : <code>'G:\Sql\Backups'</code></p>
                                                      <p>Example B : <code>'\\Sql\Backups'</code></p>
                                                      <p><code>(NVarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@BkpRetDays</td>
                                                    <td>
                                                      <p>Number of days to retain the backup files selected by their corresponding database name. Backup files that are too old, will be deleted from the backup directory.</p>
                                                      <p>NULL = no cleanup (default value).</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@BkpRetDaysForUnselectedDb</td>
                                                    <td>
                                                      <p>Number of days to retain the backup files not selected by their corresponding database name. Backup files that are too old, will be deleted from the backup directory.</p>
                                                      <p>This parameter permits the deletion of backup files for databases that don't exist anymore in the SQL server. That could happen for a test database, taken in backup, deleted after a test, and no more selected by @incDb or @excDb parameters.</p>
                                                      <p>NULL = no cleanup (default value).</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@RefDate</td>
                                                    <td>
                                                      <p>Reference date for the cleanup of backup files. This date can be provided in the following form <code>'2009-05-14 17:15'</code></p>
                                                      <p>NULL = use the current date and time. (default value).</p>
                                                      <p><code>(Datetime)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@extension</td>
                                                    <td>
                                                      <p>File extension for the backup files to be deleted. The file extention can be of any length.</p>
                                                      <p>Examples :</p>
                                                      <ul>
                                                         <li><code>'.bak'</code> for full backup files,</li>
                                                         <li><code>'.trn'</code> for transaction log backup files,</li>
                                                         <li><code>''</code> (an empty character string between too single quotes) for any kind of backup file.</li>
                                                      </ul>
                                                      <p>Default value = ''.</p>
                                                      <p><code>(sysname)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@IncDb</td>
                                                    <td>
                                                      <p>Database filter list to include in the cleanup process.</p>
                                                      <p>Each database inclusion filter must be on its own line between the quote pair.</p>
                                                      <p>Each database inclusion filter can include regular characters and wildcard characters used in the SQL « like » operator in the « Select » statement.</p>
                                                      <table class="table table-bordered">
                                                         <thead>
                                                            <tr>
                                                               <th>Wildcard character</th>
                                                               <th>Description</th>
                                                               <th>Example</th>
                                                            </tr>
                                                         </thead>
                                                         <tbody>
                                                            <tr>
                                                               <td>%</td>
                                                               <td>Any string of zero or more characters.</td>
                                                               <td>'%math%' selects all databases names that contains the word "math" anywhere in the database name.</td>
                                                            </tr>
                                                            <tr>
                                                               <td>_ (underscore)</td>
                                                               <td>Any single character.</td>
                                                               <td>'an_' selects any three-letter database names beginning with the letters "an", like "An1" or "An9" or "AnF".</td>
                                                            </tr>
                                                            <tr>
                                                               <td>[ ]</td>
                                                               <td>Any single character within the specified range ([a-f]) or set ([abcdef]).</td>
                                                               <td>'base[5-9]' finds all five-character database names with « base » as de first four characters, followed by a number between 5 and 9, like  « base5 » or « base9 ».</td>
                                                            </tr>
                                                         </tbody>
                                                      </table>
                                                      <p>@IncDb is an optional parameter. If it is absent, all databases names visible in the SQL server Management Studio database list, are selected.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@ExcDb</td>
                                                    <td>
                                                      <p>Database filter list to exclude exclude from the list of database names selected by the @incDb parameter.</p>
                                                      <p>Each database exclusion filter must be on its own line between the quote pair.</p>
                                                      <p>Each database exclusion filter can include regular characters and wildcard characters used in the SQL « like » operator in the « Select » statement.</p>
                                                      <p>@ExcDb is an optional parameter. If it is absent, no databases names selected by the @IncDb are excluded.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@JobNo</td>
                                                    <td>
                                                      <p>Current job number to record maintenance messages in the history table of YourSQLDba.</p>
                                                      <p>This parameter is generated by the global  maintenance and can be used here to add cleanup messages to the global maintenance messages, in the same job number.</p>
                                                      <p>NULL = creates a new entry in the maintenance history table of YourSQLDba. (default value).</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <h6>A. Delete all previous backup files</h6>
                                   <p>This sample delete's all backup files for all databases.</p>
                                   <p>Let's suppose that the server execute a copy of your backup files on another server. This could be done with the XCOPY command.</p>
                                   <p>The following sample could delete the backup files, after their copy on tape.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.DeleteOldBackups   
  @path = 'G:\Sql\Backups\ForXCOPY\'      -- Full path of the backup directory.  
, @BkpRetDays = 0  -- Delete backup files selected by their file name 
                   -- in the selected database list generated by 
                   -- the @IncDb and @ExcDb parameters,  
                   -- and for these files 
                   -- their age in minutes  
                   -- must be greater than (@BkpRetDays * 1440) minutes.  
, @BkpRetDaysForUnselectedDb = 0 
                   -- Delete backup files not selected by their file name  
                   -- in the selected database list generated by  
                    -- the @IncDb and @ExcDb parameters 
                   -- and for these files 
                   -- their age in minutes  
                   -- must be greater than (@BkpRetDaysForUnselectedDb * 1440) minutes. 
                   -- This parameter permits the deletion of backup files for 
                   -- databases that don't exist anymore in the SQL server.  
, @extension = ''  -- Select backup files with any extension (.bak .trn and others).</code></pre>
                                   </div>
                                   <h6>B. Delete all backup files, for some selected databases</h6>
                                   <p>This sample delete's all backup files for databases names ending with '_test', but retains files '_test' containing the word 'Archive'. </p>
                                   <p>For example Sales_test, SalesGeorge_test are selected by @IncDb, but SalesGeorge_archive_Test is excluded by @ExcDb.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.DeleteOldBackups  
 
  @path = 'G:\Sql\Backups\ForXCOPY\'      -- Full path of the backup directory.  
, @BkpRetDays = 0  -- Delete backup files selected by their file name  
                   -- in the selected database list generated by  
                   -- the @IncDb and @ExcDb parameters,  
                   -- and for these files,  
                   -- their age in minutes  
                   -- must be greater than (@BkpRetDays * 1440) minutes.  
 
, @BkpRetDaysForUnselectedDb = NULL    
                   -- Ignore backup files not selected by their file name  
                   -- in the selected database list generated by  
                   -- the @IncDb and @ExcDb parameters.  
 
, @extension = ''     -- Select backup files with any extension (.bak .trn and others).  
 
, @IncDb =     -- Each database inclusion filter must be  
               -- on its own line between the following quote pair  
'  
%[_]test  
'  
, @ExcDb =     -- Each database exclusion filter must be  
               -- on its own line between the following quote pair  
'  
%Archive%  
'</code></pre>
                                   </div>
                                   <h6>C. Execute the DeleteOldBackups procedure in a SQL Server Management Studio query window, to delete all backup files, for some selected databases</h6>
                                   <p>This sample delete's all backup files for databases names ending with '_test', but retains files '_test' containing the word 'Archive'.</p>
                                   <p>For example Sales_test, SalesGeorge_test are selected by @IncDb, but SalesGeorge_archive_Test is excluded by @ExcDb.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.DeleteOldBackups   @path = 'G:\Sql\Backups\ForXCOPY\'      -- Full path of the backup directory.  
, @BkpRetDays = 0  -- Delete backup files selected by their file name  
                   -- in the selected database list generated by  
                   -- the @IncDb and @ExcDb parameters, 
                   -- and for these files, 
                   -- their age in minutes 
                   -- must be greater than (@BkpRetDays * 1440) minutes.  
, @BkpRetDaysForUnselectedDb = NULL 
                   -- Ignore backup files not selected by their file name 
                   -- in the selected database list generated by 
                   -- the @IncDb and @ExcDb parameters.  
, @extension = ''  -- Select backup files with any extension (.bak .trn and others).  
, @IncDb =     -- Each database inclusion filter must be 
               -- on its own line between the following quote pair ' %[_]test '  
, @ExcDb =     -- Each database exclusion filter must be 
               -- on its own line between the following quote pair ' %Archive% '</code></pre>
                                   </div>
                                </div>
                                <div id="exclusive-access-and-backups-for-database-maintenance" class="section-block">
                                   <h3 class="block-title">Exclusive access and backups for database maintenance</h3>
                                   <p>Database maintenance are an important part of a DBA job.  By maintenance I mean an application software upgrade that requires a database maintenance (some schema modification for example).</p>
                                   <p>Usually application software maker is going to require you to ensure that your database is not accessible by anybody, and to have the most current backup before maintenance, so you are going to be able to restore it in case the maintenance goes wrong.</p>
                                   <p>In today interconnected world having a complete exclusive access to a database is not an easy task. Putting it in single_user mode or in restricted user access is often not a adequate solution.  A software service other than your application may try to connect to your database, locking it from any other access.  The only safe way to warrant that the database is dedicated to you is to do quickly in sequence: put it offline, put it back offline, and rename it.  By renaming it, software services, especially those who makes connection pooling won't find anymore the database, so won't reconnect to it.  The same hols true for actual user of any application.</p>
                                   <p>YourSqlDba supply three clever store procedures for that specific purpose. <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> get a most up to date backup/snapshot of the database.  Putting it strait, if you need to restore because maintenance goes into trouble, <a href="#RestoreDbAtStartOfMaintenanceMode">Maint.RestoreDbAtStartOfMaintenanceMode</a> will use them to allow you to get your database as it was before the maintenance.</p>
                                   <p>If you use SQL Server Entreprise Edition, <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> does a snapshot of the database, which is a very quick way to get a backup equivalent of a database, and a very quick mean to rollback changes to a database.  For other editions, if your database is in full recovery mode, it performs a log backup  (with log mark for precise point-in-time restore) which is quick and sufficient to do a complete up to date restore of your database, given that daily full backup is there and all other log backups.  If it is in simple recovery mode, it performs a full back which is the only mean YourSqlDba supplies to warrant an backup up to date to restore.</p>
                                   <p>In case of maintenance failure that request a database restore you need to bring back database at how it was at start of maintenance. For that purpose you do a <a href="#RestoreDbAtStartOfMaintenanceMode">Maint.RestoreDbAtStartOfMaintenanceMode</a> which brings back the renamed database to its initial state.  If your maintenance failed because a problem that can be solved, e.g. like a lack of space, you can then attempt again the maintenance.  Either you succeed or you just restore the database with not further attempt to maintenance it, you must return DB to normal use, which just mean to rename it back to its initial name.  For that purpose just run <a href="#ReturnDbToNormalUseFromMaintenanceMode">Maint.ReturnDbToNormalUseFromMaintenanceMode</a>.  Essentially it renames the database in its current state by removing the same suffix you specified in parameter. This one must be the same as the one you specified when using <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>.</p>
                                </div>
                                <div id="PrepDbForMaintenanceMode" class="section-block">
                                   <h3 class="block-title">Maint.PrepDbForMaintenanceMode</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>This procedure offers a mean to get exclusive access to a database, by changing the database name.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                            <p>Some mainteance processes required that a user (usually an application administrator or a DBA) has an exclusive access to the database.  External connections from applications or services or users must be kicked out of the database, and prevented from re-accessing the database for the duration of the maintenance process. Ongoing transactions must be rollbacked in the disconnection process.  Only a database renaming process insures this state.  The administrator must have a way to switch quickly to the new database name by having some connections definitions (ODBC data source or connect string configuration files) ready for the new database name and only accessible for him.  External connections cannot have access to the database anymore because they still point to the old database name.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <p>This procedure offer a mean to get exclusive access by performing the following actions :</p>
                                   <ol>
                                      <li>Kill all connections to the databases selected with rollback of the transactions.</li>
                                      <li>Rename the databases.</li>
                                      <li>Nobody is able to connect to the original database since its name is changed.</li>
                                   </ol>
                                   <p>The new name is build with the original name + '_' + @DbNameSuffixForMaintenance.</p>
                                   <ol>
                                      <li>Put the newly renamed databases in « MULTI_USER ».</li>
                                      <li>Do a full backup when the parameter @PathOfBackupBeforeMaintenance is completed. </li>
                                   </ol>
                                   <p>The backup file name is build with the original database name + '_' + @DbNameSuffixForMaintenance+ '.BAK'. </p>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DbList </td>
                                                    <td>
                                                      <p>One or many databases name, see sample below to see how to specify multiple databases.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@DbNameSuffixForMaintenance</td>
                                                    <td>
                                                      <p>Suffix to add to the database name to rename it.</p>
                                                      <p><code>(NVarchar(128))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@PathOfBackupBeforeMaintenance</td>
                                                    <td>
                                                      <p>Path of the backup that will be used to return the database to its current state at this procedure completion, in case of maintenance failure. Recommended, otherwise specify an empty string.</p>
                                                      <p>When the @PathOfBackupBeforeMaintenance is absent and a full backup exist for the database; the <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> procedure executes a log backup.</p>
                                                      <p>This log backup will be appended to the previous log backup file; even if in the log backup job @BkpLogsOnSameFile = 0</p>
                                                      <p>(Create a new backup file for each log backup).</p>
                                                      <p><code>(NVarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@SetRecoveryModeToSimple</td>
                                                    <td>
                                                      <p>Option to put the database in the « Simple » recovery mode, in preparation for the maintenance.</p>
                                                      <p>1 = yes  (put the database in the « Simple » recovery mode)</p>
                                                      <p>0 = no  (default) recommended option.</p>
                                                      <p>The "Simple" recovery mode reduces the size of the log file necessary for the maintenance when you have limited disk space.</p>
                                                      <p>But the « Simple» recovery mode breaks the restoration sequence and a full backup will be done by the stored proc <a href="#ReturnDbToNormalUseFromMaintenanceMode">Maint.ReturnDbToNormalUseFromMaintenanceMode</a>.</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <h6>A. Get exclusive access to databases <strong>GPI1, GPI2 et GPI3</strong></h6>
                                   <p>This sample shows how to get exclusive access to databases <strong>GPI1, GPI2, GPI3</strong>.</p>
                                   <p>All connections will be closed on databases <strong>GPI1, GPI2, GPI3</strong>.</p>
                                   <p>They will be renamed to <strong>GPI1_Maintenance, GPI2_Maintenance, GPI3_Maintenance</strong>.</p>
                                   <p>A backup of these will be put in <strong>d:\backups</strong>, under the names <strong>GPI1_Maintenance.bak, GPI2_Maintenance.bak, GPI3_Maintenance.bak</strong>.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.PrepDbForMaintenanceMode 
  @DbList =    -- Each database must be listed on its own line    
  '    
  GPI1 
  GPI2 
  GPI3 
  ' 
, @DbNameSuffixForMaintenance= 'Maintenance' 
, @PathOfBackupBeforeMaintenance = 'G:\Sql\backups'</code></pre>
                                   </div>
                                   <h6>B. Get exclusive access to databases GPI1, GPI2, and don't change the recovery mode</h6>
                                   <p>This sample shows how to get exclusive access to databases <strong>GPI1, GPI2</strong>.</p>
                                   <p>All connections will be closed on databases <strong>GPI1, GPI2</strong>.</p>
                                   <p>They will be renamed to <strong>GPI1_Maintenance, GPI2_Maintenance</strong>.</p>
                                   <p>A backup of these will be put in <strong>d:\backups</strong>, under the names <strong>GPI1_Maintenance.bak, GPI2_Maintenance.bak.</strong></p>
                                   <p>The recovery mode will not be changed.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.PrepDbForMaintenanceMode 
  @DbList =    -- Each database must be listed on its own line    
'  
  GPI1 
  GPI2    
'       
, @DbNameSuffixForMaintenance = 'Maintenance'  
, @PathOfBackupBeforeMaintenance = G:\Sql\backups' 
, @SetRecoveryModeToSimple = 0</code></pre>
                                   </div>
                                </div>
                                <div id="RestoreDbAtStartOfMaintenanceMode" class="section-block">
                                   <h3 class="block-title">Maint.RestoreDbAtStartOfMaintenanceMode</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>This procedure restores the selected databases in the state they were just after the call to <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>.</p>
                                            <p>Upon completion, the database state is the same as it was immediately after the call to <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>. This allows another Maintenance attempt. It also allows postponing of the maintenance process by making the database available to user with a call to <a href="#ReturnDbToNormalUseFromMaintenanceMode">Maint.ReturnDbToNormalUseFromMaintenanceMode</a>.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                            <p>This procedure requires that the <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> procedure has been executed.</p>
                                            <p>Its parameters must match those specified by <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>. The @DbList parameter can contain a subset of the database set specified for <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DbList </td>
                                                    <td>
                                                      <p>A list of one or many database names, see sample below to see how to specify multiple names. The database list can be a subset of the corresponding list passed to <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@DbNameSuffixForMaintenanceProcess </td>
                                                    <td>
                                                      <p>Suffix to add to the database names to rename them.</p>
                                                      <p><code>(NVarchar(128))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@PathOfBackupBeforeMaintenance </td>
                                                    <td>
                                                      <p>If full backups have been produced by the <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> procedure; specify here the path of the directory for those full backups.<p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>The path for the full backups will be used to return the databases to their previous state.  This is useful in the case of an maintenance failure.</p>
                                                      <p>Note that each full backup file name includes the database name, followed by the chosen suffix and the ".BAK" extension.</p>
                                                      <p>When the <strong>@PathOfBackupBeforeMaintenance</strong> is absent and full backups exist for the databases; the <strong>RestoreDbAtStartOfMaintenanceMode</strong> procedure executes a restore of those full backups and restores all log backups up to the moment when the <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> procedure has been executed.</p>
                                                      <p><code>(NVarchar(512))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <p>This sample restore among databases renamed and backuped by <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> databases specified in @DbList which are in this sample 'GPI1, GPI2'. They are returned to their state as they where immediately after the call at <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>. The parameter @DbList can be a subset of the databases processed by <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a> if it is not necessary to restore all of them.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.RestoreDbAtStartOfMaintenanceMode  
  @DbList =  -- Each database must be listed on its own line  
  '  
  GPI1  
  GPI2  
  '       
  , @DbNameSuffixForMaintenance= 'Maintenance'    
  , @PathOfBackupBeforeMaintenance = 'G:\Sql\backups'</code></pre>
                                   </div>
                                   <p><strong>Maint.ReturnDbToNormalUseFromMaintenanceMode</strong></p>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Rename databases to their original names from the names given by «PrepDbForMaintenanceMode». If the database is part of YourSqlDba full backup plan, a new full backup and log backup are performed on a new file sequence.  Latest backup made before mainteance are kept inintact.  YourSqlDba's stored procedure <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a> is used to perform the new backup.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                            <p>Parameters must match those used for <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>. Parameter @DbList can be a subset of the one given to <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DbList </td>
                                                    <td>
                                                      <p>One or many databases name, see sample below to see how to specify multiple names. Could be a subset of the corresponding list passed to <a href="#PrepDbForMaintenanceMode">PrepDbForMaintenanceMode</a>.  Theses are the original names of the database before rename by <a href="#PrepDbForMaintenanceMode">PrepDbForMaintenanceMode</a>.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@DbNameSuffixForMaintenance </td>
                                                    <td>
                                                      <p>Suffix used to rename the database.</p>
                                                      <p><code>(NVarchar(128))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Sample</h5>
                                   <p>This sample takes databases renamed and backup by Maint.PrepDbForMaintenanceMode,  and renames them to their original name.  Databases specified in @DbList (in this sample only 'GPI1, GPI2') can be a subset of the ones specified to PrepDbForMaintenanceMode.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.ReturnDbToNormalUseFromMaintenanceMode  
  @DbList =  -- Each database must be listed on its own line  
  '  
  GPI1  
  GPI2  
  '       
, @DbNameSuffixForMaintenance = 'Maintenance'</code></pre>
                                   </div>
                                </div>
                                <div id="ReturnDbToNormalUseFromMaintenanceMode" class="section-block">
                                   <h3 class="block-title">Maint.ReturnDbToNormalUseFromMaintenanceMode</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Rename databases to their original names from the names given by «PrepDbForMaintenanceMode». If the database is part of YourSqlDba full backup plan, a new full backup and log backup are performed on a new file sequence.  Latest backups before Maintenance are kept intact.  YourSqlDba's stored procedure <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a> is used to perform the new backup.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                            <p>Parameters must match those used for <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>. Parameter @DbList can be a subset of the one given to <a href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DbList </td>
                                                    <td>
                                                      <p>One or many databases name, see sample below to see how to specify multiple names. Could be a subset of the corresponding list passed to <a href="#PrepDbForMaintenanceMode">PrepDbForMaintenanceMode</a>.  Theses are the original names of the database before rename by <a href="#PrepDbForMaintenanceMode">PrepDbForMaintenanceMode</a>.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@DbNameSuffixForMaintenanceProcess</td>
                                                    <td>
                                                      <p>Suffix used to rename the database.</p>
                                                      <p><code>(NVarchar(128))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <p>This sample takes databases renamed and taken in backup by Maint.PrepDbForMaintenanceMode,  and renames them to their original name.  Databases specified in @DbList (in this sample only 'GPI1, GPI2') can be a subset of the ones specified to PrepDbForMaintenanceMode.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.ReturnDbToNormalUseFromMaintenanceMode  
  @DbList =  -- Each database must be listed on its own line  
  '  
  GPI1  
  GPI2  
  '       
, @DbNameSuffixForMaintenance= 'Maintenance'</code></pre>
                                   </div>
                                </div>
                                <div id="diagnostics-maintenance-performance" class="section-block">
                                   <h3 class="block-title">Diagnostics (maintenance, performance)</h3>
                                   <p>YourSqlDba is well provided in tools for maintenance diagnostics.  It produces a detailed log of all maintenance queries generated, each with completion and plus error messages if any.  Output is redirected to Maint.JobHistory and Maint.JobHistoryDetails.</p>
                                   <h4>Common problems</h4>
                                   <ol>
                                      <li>
                                          <p>After a new installation of YourSqlDba you may received theses messages:</p>
                                          <ol>
                                             <li>
                                                <p>An error message saying that log backup on a given database, can't be performed as long a new full backup of differential backup is not done.</p>
                                                <p class="indented-paragraph">This is normal, as this is a SQL Server requirement.  This will disappear at full maintenance where full backup are taken.  You can also start full maintenance task or extract full maintenance step query and modify parameters to just perform full backups.</p>
                                             </li>
                                             <li>
                                                <p>An error message saying some databases are not in full recovery mode.</p>
                                                <p class="indented-paragraph">By default the maintenance engine ensure that all databases must be in full recovery mode, which allows regular log backups through the day and then the possibility to do point-in-time restore.  This is a thing which is very valuable for production databases. However if you have test databases on the same server you would wish to exclude them from this verification.  See procedure Maint.YourSqlDba_DoMaint in SP Reference section.  Check for parameter@ExcDbFromPolicy_CheckFullRecoveryModel to exclude test databases from this check.</p>
                                             </li>
                                          </ol>
                                      </li>
                                   </ol>
                                   <h4>Maintenance diagnostics</h4>
                                   <p>To consult these tables we provide the procedure <a href="#ShowHistory">Maint.ShowHistory</a> which display current log from most recent activity, with alternate resultsets, one for the job, one for the details, and repeat that for each other job. Job details can be informative messages only or maintenance queries generated with their results.</p>
                                   <p><a href="#ShowHistory">Maint.ShowHistory</a> have also optional parameters: one being the job number, a switch to filter out queries with errors only, another to limit the number of job displayed and a last one to display more diagnostic info.</p>
                                   <p>Another procedure <a href="#ShowHistoryErrors">Maint.ShowHistoryErrors</a> just calls <a href="#ShowHistory">Maint.ShowHistory</a> with error filtering option.</p>
                                   <p>When YourSqlDba completes successfully its maintenance it sends an email with the appropriate call to <a href="#ShowHistory">Maint.ShowHistory</a> with appropriate parameters (like job number completed) to display entries specific for that job.  It is easier cut and paste the procedure call this way to pinpoint job details.</p>
                                   <p>When YourSqlDba detects error during maintenance it adds to the email the call to <a href="#ShowHistoryErrors">Maint.ShowHistoryErrors</a> with appropriate parameters to display errors specific to this job only.  It is easier cut and paste the procedure call this way to pinpoint maintenance queries that ran into problems.</p>
                                   <h4>Database Mail diagnostics</h4>
                                   <p><a href="#DiagDbMail">Maint.DiagDbMail</a> queries 3 Msdb tables related to Database mail diagnostics. This is an efficient way to find out why YoursqlDba alerts or messages doesn't go through.</p>
                                   <h4>Performance diagnostics</h4>
                                   <p><strong>Another goodie are the performance monitoring procedures and functions</strong>. They are based on Paul Randal's queries to monitor SQL Server wait states: <a href="#ResetAnalyzeWaitStats">PerfMon.ResetAnalyzeWaitStats</a> reset wait stats accumulated since last call of <a href="#AnalyzeWaitStats">PerfMon.AnalyzeWaitStats</a>. See <a href="#AnalyzeWaitStats">PerfMon.AnalyzeWaitStats</a> for more info on how to use it.</p>
                                </div>
                                <div id="ShowHistory" class="section-block">
                                   <h3 class="block-title">Maint.ShowHistory</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Display the job maintenance history. It displays two results sets for each job. First a job summary, followed by the job details. It displays the jobs in most recent order. It displays at most 40 jobs at the same time. Optional filtering parameters are available.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@JobNo </td>
                                                    <td>
                                                      <p>Starts from this job number as the first one.</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@DispLimit</td>
                                                    <td>
                                                      <p>Limit the number of job displayed (max 40).</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@FilterErr</td>
                                                    <td>
                                                      <p>Just display Job and job's details for which an error is recorded.</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.ShowHistory  -- display current activity  
                                 -- (topmost job, with current job detail) 
    
Exec YourSQLDba.Maint.ShowHistory  
  @JobNo = 3210    -- display job 3210 at top, followed by older jobs in order of age 
, @DispLimit = 1   -- limit display to 1 job  
, @FilterErr = 1   -- filter jobs with errors, and job details with errors</code></pre>
                                   </div>
                                </div>
                                <div id="ShowHistoryErrors" class="section-block">
                                   <h3 class="block-title">Maint.ShowHistoryErrors</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Display error messages in the job maintenance history. It displays two results sets for each job. First a job summary, followed by the job details. It displays the jobs in most recent order. Optional filtering parameters are available.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@JobNo </td>
                                                    <td>
                                                      <p>Starts to display from this job number.</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@DispLimit</td>
                                                    <td>
                                                      <p>Limit the number of job displayed (max 40).</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.ShowHistoryErrors  -- display most recent error messages.  
   
Exec YourSQLDba.Maint.ShowHistoryErrors  
  @JobNo = 3210    -- display job 3210 error messages.  
   
Exec YourSQLDba.Maint.ShowHistoryErrors  
  @JobNo = 3210    -- display job 3210 error messages at top, followed by older 
                   -- jobs in order of age.  
, @DispLimit = 5   -- limit display to 5 jobs.</code></pre>
                                   </div>
                                </div>
                                <div id="ResetAnalyzeWaitStats" class="section-block">
                                   <h3 class="block-title">PerfMon.ResetAnalyzeWaitStats</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Reset Average Wait SQL Server statistics that indicates where are main performance problem (when a intensive resource consumption occurs) due to resources limitations.  Resources limitations can be  due to inadequate queries.  See <a href="#AnalyzeWaitStats">PerfMon.AnalyzeWaitStats</a> for more explanations.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h5>Samples</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.PerfMon.ResetAnalyzeWaitStats</code></pre>
                                   </div>
                                </div>
                                <div id="AnalyzeWaitStats" class="section-block">
                                   <h3 class="block-title">PerfMon.AnalyzeWaitStats</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Reset Average Wait SQL Server statistics that indicates where are main performance problem (when a intensive resource consumption occurs) due to resources limitations. Resources limitations can be  due to inadequate queries.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h5>Usage</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">SELECT * FROM YourSQLDba.PerfMon.AnalyzeWaitStats ()</code></pre>
                                   </div>
                                   <h5>Output</h5>
                                   <p>WaitType and percentage are main column to pay attention when an intensive task occurs. When no intensive task occurs, it only means relative waits not a performance problem. You must run this query repeatedly for a while during intensive tasks after an initial call to <a href="#ResetAnalyzeWaitStats">PerfMon.ResetAnalyzeWaitStats</a>. The more the time of the intensive task ran since the last reset, the more you get the average wait time. Seek advice on the net on how to interpret these results. Not all high wait stats means a performance problem. Here an output of this function during idle time.</p>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>WaitType</th>
                                                    <th>Wait_S</th>
                                                    <th>Resource_S</th>
                                                    <th>Signal_S</th>
                                                    <th>WaitCount</th>
                                                    <th>Percentage</th>
                                                    <th>AvgWait_S</th>
                                                    <th>AvgRes_S</th>
                                                    <th>AvgSig_S</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>CXPACKET</td>
                                                    <td>141.67</td>
                                                    <td>85.75</td>
                                                    <td>55.93</td>
                                                    <td>75541</td>
                                                    <td>32.42</td>
                                                    <td>0.0019</td>
                                                    <td>0.0011</td>
                                                    <td>0.0007</td>
                                                </tr>
                                                <tr>
                                                    <td>OLEDB</td>
                                                    <td>111.12</td>
                                                    <td>111.12</td>
                                                    <td>0.00</td>
                                                    <td>2275952</td>
                                                    <td>25.43</td>
                                                    <td>0.0000</td>
                                                    <td>0.0000</td>
                                                    <td>0.0000</td>
                                                </tr>
                                                <tr>
                                                    <td>ASYNC_IO_COMPLETION</td>
                                                    <td>41.21</td>
                                                    <td>41.21</td>
                                                    <td>0.01</td>
                                                    <td>241</td>
                                                    <td>9.43</td>
                                                    <td>0.1710</td>
                                                    <td>0.1710</td>
                                                    <td>0.0000</td>
                                                </tr>
                                                <tr>
                                                    <td>BACKUPBUFFER</td>
                                                    <td>41.03</td>
                                                    <td>40.84</td>
                                                    <td>0.19</td>
                                                    <td>15442</td>
                                                    <td>9.39</td>
                                                    <td>0.0027</td>
                                                    <td>0.0026</td>
                                                    <td>0.0000</td>
                                                </tr>
                                                <tr>
                                                    <td>PAGEIOLATCH_SH</td>
                                                    <td>20.71</td>
                                                    <td>19.55</td>
                                                    <td>1.16</td>
                                                    <td>16646</td>
                                                    <td>4.74</td>
                                                    <td>0.0012</td>
                                                    <td>0.0012</td>
                                                    <td>0.0001</td>
                                                </tr>
                                                <tr>
                                                    <td>BACKUPIO</td>
                                                    <td>20.38</td>
                                                    <td>19.87</td>
                                                    <td>0.51</td>
                                                    <td>76399</td>
                                                    <td>4.66</td>
                                                    <td>0.0003</td>
                                                    <td>0.0003</td>
                                                    <td>0.0000</td>
                                                </tr>
                                                <tr>
                                                    <td>BACKUPTHREAD</td>
                                                    <td>12.62</td>
                                                    <td>12.47</td>
                                                    <td>0.16</td>
                                                    <td>7427</td>
                                                    <td>2.89</td>
                                                    <td>0.0017</td>
                                                    <td>0.0017</td>
                                                    <td>0.0000</td>
                                                </tr>
                                                <tr>
                                                    <td>WRITE_COMPLETION</td>
                                                    <td>12.00</td>
                                                    <td>0.09</td>
                                                    <td>11.91</td>
                                                    <td>36067</td>
                                                    <td>2.75</td>
                                                    <td>0.0003</td>
                                                    <td>0.0000</td>
                                                    <td>0.0003</td>
                                                </tr>
                                                <tr>
                                                    <td>LCK_M_S</td>
                                                    <td>7.52</td>
                                                    <td>7.51</td>
                                                    <td>0.01</td>
                                                    <td>44</td>
                                                    <td>1.72</td>
                                                    <td>0.1708</td>
                                                    <td>0.1707</td>
                                                    <td>0.0002</td>
                                                </tr>
                                                <tr>
                                                    <td>WRITELOG</td>
                                                    <td>7.09</td>
                                                    <td>6.72</td>
                                                    <td>0.37</td>
                                                    <td>20885</td>
                                                    <td>1.62</td>
                                                    <td>0.0003</td>
                                                    <td>0.0003</td>
                                                    <td>0.0000</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="DiagDbMail" class="section-block">
                                   <h3 class="block-title">Maint.DiagDbMail</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Diagnose mail problems.</p>
                                            <p>This stored procedure <strong>requires no parameter</strong> and simply produce three results sets:</p>
                                            <ul>
                                               <li>First, it lists email error log. Problems like mail server access or mail server communication are clearly listed in the description field, with a timestamp to indicate when it occurred.</li>
                                               <li>Second, it lists emails sent, which is a proof that email server sent it, but it was caught somewhere between the SQL server and the mail server (by the anti-spam engine or the antivirus).</li>
                                               <li>Third, it lists the state of the database mail engine. Is it up and running?</li>
                                            </ul>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h5>Sample</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.DiagDbMail</code></pre>
                                   </div>
                                </div>
                                <div id="managing-network-drives-for-backup-purposes" class="section-block">
                                   <h3 class="block-title">Managing network drives for backup purposes</h3>
                                   <p>For some technical reason network drive mapping must be done by the database engine service when it starts.</p>
                                   <p>To perform that, you must set a SQL Server Database Engine service account that have access to network location that are going to be associated with.</p>
                                   <p>If it is a normal windows user that belongs to the same windows domain that access network location, just grant it appropriates access rights (full access).</p>
                                    <div class="callout-block callout-warning">
                                        <div class="icon-holder">
                                            <i class="fab fa-windows"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Heads up</h4>
                                            <p>If it is not the case, this account <strong>MUST BE SET through SQL Server configuration manager</strong> as it is MANDATED by Microsoft to make this account to have proper rights for SQL Server operations.  It is also especially critical in case of database encryption. Seek help for complimentary procedures related to database encryption and changing SQL Server Database Engine service account.</p>
                                            <p>Changing SQL Server database Engine service account requires a service restart.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <p>Once done you can manage network drives that are going to be set by SQL Server Database Engine service using the following procedures:</p>
                                   <p><a href="#CreateNetworkDrives">Maint.CreateNetworkDrives</a>, <a href="#DisconnectNetworkDrive">Maint.DisconnectNetworkDrive</a> and <a href="#ListNetworkDrives">Maint.ListNetworkDrives</a>.</p>
                                </div>
                                <div id="CreateNetworkDrives" class="section-block">
                                   <h3 class="block-title">Maint.CreateNetworkDrives</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p> Immediately map drive letters to network location.  Inserts the mapping into the <strong>Maint.NetworkDrivesToSetOnStartup</strong> table, so SQL Server will remap them at startup by executing autostart procedure <strong>dbo.YourSqlDbaAutostart_ReconnectNetworkDrive</strong>. This is the only object that YouSqlDba puts in master</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usage notes</h4>
                                            <p>Map drive letters are only visible to the database engine, not to windows explorer, and can't be used in another windows session because of the fact that they are already in use by SQL Server database engine session.  To succeed SQL Server database service account must be authenticable to the network resource, in windows authentication mode.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DriveLetter</td>
                                                    <td>
                                                      <p>Drive letter to map on a UNC network location.</p>
                                                      <p>Example: <code>'R:'</code></p>
                                                      <p><code>(NChar(2))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@unc</td>
                                                    <td>
                                                      <p>UNC (Universal Naming Convention) network location to be mapped.</p>
                                                      <p>Example: <code>'\\sql.rd.grics.qc.ca\SQL2005Backups'</code></p>
                                                      <p><code>(NVarchar(255))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Sample</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.CreateNetworkDrives 
  @DriveLetter = 'R:'   -- Drive letter to use 
, @unc = '\\MyBackupServer\backupShare' -- UNC to the shared resource</code></pre>
                                   </div>
                                </div>
                                <div id="DisconnectNetworkDrive" class="section-block">
                                   <h3 class="block-title">Maint.DisconnectNetworkDrive</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Delete network mapping, and remove network mapping definition from NetworkDrives table.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DriveLetterOrUNC</td>
                                                    <td>
                                                      <p>Drive letter to Disconnect.</p>
                                                      <p>Example: <code>'R:'</code></p>
                                                      <p><code>(NVarchar(255))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Sample</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.DisconnectNetworkDrive  
  @DriveLetterOrUNC = 'R:'  -- network drive definition to remove and delete</code></pre>
                                   </div>
                                </div>
                                <div id="ListNetworkDrives" class="section-block">
                                   <h3 class="block-title">Maint.ListNetworkDrives</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Show existing network drive definition in <strong>Maint.NetworkDrivesToSetOnStartup</strong> table.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="alert alert-info">No parameters required</div>
                                   <h5>Sample</h5>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Maint.ListNetworkDrives</code></pre>
                                   </div>
                                </div>
                                <div id="Mirroring" class="section-block">
                                   <h3 class="block-title">Mirroring</h3>
                                   <p>YourSqlDba mirroring is much more similar to standby server than real database mirroring in SQL Server.  it is based on backup and restored continuously to another server call the mirror server.  This has a great advantages.</p>
                                   <ul>
                                      <li>First it proves to you that every backups you makes are valid, since they are restored.</li>
                                      <li>It gives you a mean to have quickly a working server with very recent databases (since log backups are taken from source server every 15 minutes, and restore immediately to mirror server, there are at most 15 minutes behind your production databases.</li>
                                      <li>Licencing model doesn't require a supplemental licence for this server if it is not used as a production server.  License can be transferred temporary to this server for 30 days as long and after it needed to be reviewed to see if it matches licencing requirements.</li>
                                   </ul>
                                   <p>YourSqlDba needs linked served to communicate with the mirror server.  First in needs an standard sysadmin standard account on the destination server.  Then use <a href="#AddServer">Mirroring.AddServer</a> to define it properly.</p>
                                   <p>Next modify job step that perform backups with <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> stored procedure. Pay attention to parameters @mirrorServer,  @ReplacePathsInDbFileNames and  @ReplaceSrcBkpPathToMatchingMirrorPath.  Parameter   @ReplacePathsInDbFileNames is mandatory in many circumstances.</p>
                                   <p>The first parameter @mirrorServer is mandatory for the jobstep that does full backup and the one that does log backups.  The second is needed if your databases locations can't be the same on the source and target servers.  The last is needed when backup location can be expressed in the same way from the source and the destination server.  This happen when for example when you backup to a UNC share which is a directory on the mirror server, and you want to translate this UNC location into a real local directory path.</p>
                                   <p>Failover of selected database is performed using <a href="#Failover">Mirroring.Failover</a> if source server is able to do it and must be always attempted, because if puts offline source databases that must not be accessible anymore. <a href="#DoRecovery">Mirroring.DoRecovery</a> takes selected target server databases our of restoring mode this available to application.  This does not the magic of changing connection strings to point to the new server.  Some admin change server name instead to do the trick or change DNS entries.</p>
                                   <p>Mirroring can be used as a trick to reduce maintenance windows required to achieve migration of application's databases compatibles to a newer version of SQL Server.  You set up a mirror server to this newer instance version.  The next night all backups full backup are going to be restore to destination server.  During the next day all log backups are going to be restored every 15 minutes.  This is here that <a href="#Failover">Mirroring.Failover</a> does the magic.  It gets the last log backup from source server and restore it and puts source database offline.</p>
                                   <p>It is much quicker to get the latest version of the database.  For databases in simple recovery mode it performs complete backup/restore again.   Usually most production databases are in complete recovery mode and log backup restore does the trick for them. <a href="#Failover">Mirroring.Failover</a> have database selection parameters, so we suggest to restrict the list of database to production database first.  Other databases migration can then be deferred to later.  During the process some minimal compatibility trick can be done.  One is related to fulltext catalogs disk structure that change from SQL2005 to later versions. <a href="#Failover">Mirroring.Failover</a> calls <a href="#MakeDbCompatibleToTarget">Upgrade.MakeDbCompatibleToTarget</a> to convert them to the new structure.</p>
                                </div>
                                <div id="AddServer" class="section-block">
                                   <h3 class="block-title">Mirroring.AddServer</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Add a mirror SQL instance in YourSQLDba for the source SQL instance.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Usefulness of the mirror SQL instance</h4>
                                            <p>The SQL Agent jobs which uses this mirror SQL instance name in the parameter, will execute a restore of the backups to the mirror SQL instance.</p>
                                            <p>The goal of this restoration is to verify the integrity of the backup files.</p>
                                            <p>The mirror SQL instance will also contain a copy of the logins, to allow it to become a standby server.</p>
                                            <p>The automatic restoration works like this; as soon as YourSQLDba generates a backup file, it restores it to a mirror SQL instance.  If this restoration fails, an email is sent to the SQL administrator.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h6>Prerequisite to use this functionality:</h6>
                                   <ul>
                                      <li>Both SQL instances must have the same YourSQLDba version. You can execute <strong>YourSQLDba.Install.ShowAndKeepTrackOfVersionInfo</strong> to see the YourSQLDba version.</li>
                                      <li>Backup directories must be accessible by both SQL instances. If both SQL instances are not on the same machine, the backup directories must be network shared like <code>'\\server\SQLBackupShare'</code>.</li>
                                      <li>The SQL Server Agent starting account on the source instance must also exist as a « sysadmin » login on the mirror SQL instance.</li>
                                      <li>On first use, the original databases must not exist on the mirror SQL instance.</li>
                                      <li>Databases to be restored on the mirror SQL instance must ALWAYS be in the « RECOVERING » state on the mirror instance, for as long as the automatic backup restoration functionality is activated.</li>
                                   </ul>
                                   <p>Workings of the "Mirroring.AddServer" procedure</p>
                                   <p>The Mirroring.AddServer adds the mirror SQL instance to YourSQLDba by doing the following :</p>
                                   <ul>
                                      <li>It creates a link server for the mirror SQL instance.</li>
                                      <li>It tests that YourSQLDba versions are the same on both SQL instances.</li>
                                      <li>It adds the mirror instance name in the <strong>Mirroring.TargetServer</strong> table on the source instance.</li>
                                      <li>It adds the source instance name in the <strong>Mirroring.TargetServer</strong> table on the mirror instance.</li>
                                      <li>It executes a copy of all SQL logins to the mirror SQL instance.</li>
                                   </ul>
                                   <div class="alert alert-info">Execute the global maintenance after the execution of Mirroring.AddServer</div>
                                   <p>After the execution of the Mirroring.AddServer procedure and for each databases with a recovery model Full or Bulk-logged, you must execute the <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> or <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a> procedure to generate a full backup for each mirrored database in the mirror instance.</p>
                                   <p>If there is no full backup of the database when the next log backup is executed, YourSQLDba will send an email to the database administrators to warn that a full backup must be done before making a log backup.</p>
                                   <p>The email will lead you to the following error message:</p>
                                   <p><code>To restore a LOG backup to the mirror server the database "your database name" in the mirror server must exist and be in «RESTORING» state.</code></p>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@MirrorServer</td>
                                                    <td>
                                                      <p>Mirror SQL instance name.</p>
                                                      <p><strong>(Required parameter)</strong>.</p>
                                                      <p>Example: <code>'MirrorServ\MirrorSQL2005'</code></p>
                                                      <p><code>(NVarchar(255))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@RemoteLogin</td>
                                                    <td>
                                                      <p>SQL login of type « SQL Server authentication » in the mirror SQL instance.</p>
                                                      <p><strong>(Required parameter)</strong>.</p>
                                                      <p>This login must have <strong>sysadmin</strong> server role in the mirror SQL instance.</p>
                                                      <p>You can use the 'sa' login.</p>
                                                      <p><code>(NVarchar(255))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@RemotePassword </td>
                                                    <td>
                                                      <p>Password for the login in the the mirror SQL instance.</p>
                                                      <p><strong>(Required parameter)</strong>.</p>
                                                      <p><code>(NVarchar(255))</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@YourSqlDbaAccountForMirroringPwd </td>
                                                    <td>
                                                      <p><strong>(Facultative)</strong>.</p>
                                                      <p>Password of the YourSqlDba login. <u>Only required</u> when if multiple mirroring source instances of YourSqlDba share the same destination server.</p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Sample</h5>
                                   <h6>Add a mirror SQL instance in YourSQLDba for the source SQL instance</h6>
                                   <p>This example adds the mirror SQL instance 'MirrorServ\MirrorSQL2005' in YourSQLDba for the source SQL instance.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">-- This command must be executed in the source instance  
Exec YourSQLDba.Mirroring.AddServer  
  @MirrorServer = 'MirrorServ\MirrorSQL2005'  
, @RemoteLogin = 'sa'  
, @RemotePassword = 'RemotePassword'</code></pre>
                                   </div>
                                </div>
                                <div id="DoRecovery" class="section-block">
                                   <h3 class="block-title">Mirroring.DoRecovery</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Make selected databases out of restoring state in the SQL mirror server to make them accessible.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Prerequisite to execute "Mirroring.DoRecovery"</h4>
                                            <p>The databases to be restored in the SQL mirror instance must be in the "(RESTORING)" state.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-warning">
                                        <div class="icon-holder">
                                            <i class="fas fa-server"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Execute a full backup after the recovery</h4>
                                            <p>After the execution of the <strong>Mirroring.DoRecovery</strong> procedure and for each databases with a recovery model <strong>Full</strong> or <strong>Bulk-logged</strong>, you must make a full backup of the recovered databases. On the next log backup, YourSQLDba will send an email to the database administrators to warn that a full backup must be done before making a log backup.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <p>The email will lead you to the following error message:</p>
                                   <p><code>Log backup forbidden before doing a first full backup of [ "database name" ] status is "status of the database".</code></p>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@IncDb</td>
                                                    <td>
                                                      <p>List of databases to be made accessible.</p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>When left empty, all databases are selected.</p>
                                                      <p>Each database inclusion filter must be on its own line between the single quotes.</p>
                                                      <p>The databases names in the list, can include wildcard characters from the "Select" instruction "like" clause.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                      <table class="table table-bordered">
                                                         <thead>
                                                            <tr>
                                                               <th>Wildcard character</th>
                                                               <th>Description</th>
                                                               <th>Example</th>
                                                            </tr>
                                                         </thead>
                                                         <tbody>
                                                            <tr>
                                                               <td>%</td>
                                                               <td>Any string of zero or more characters.</td>
                                                               <td>'%base%' selects all databases names that contains the word "base" anywhere in the database name.</td>
                                                            </tr>
                                                            <tr>
                                                               <td>_ (underscore)</td>
                                                               <td>Any single character.</td>
                                                               <td>'an_' selects any three-letter database names beginning with the letters "an", like "An1" or "An9" or "AnF".</td>
                                                            </tr>
                                                            <tr>
                                                               <td>[0-9]</td>
                                                               <td>Any single character between 0 and 9.</td>
                                                               <td>'base[5-9]' selects any five-letter database names beginning with the letters "base", and followed by a number between 5 and 9, like « base5 » or « base9 ».</td>
                                                            </tr>
                                                            <tr>
                                                               <td>[_]</td>
                                                               <td>The underscore character.</td>
                                                               <td>'%[_]test' selects any database names ending with the characters "_test". The underscore between brackets is interpreted as a character instead of a wildcard character. It is the same behaviour with '%', ']' and '['.</td>
                                                            </tr>
                                                         </tbody>
                                                      </table>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@ExcDb</td>
                                                    <td>
                                                      <p>List of databases to exclude from the database list generated by the <strong>@IncDb</strong> parameter.</p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>When the list is empty, no database is excluded.</p>
                                                      <p>Each database exclusion filter must be on its own line between the single quotes.</p>
                                                      <p>The databases names in the list, can include wildcard characters from the "Select" instruction "like" clause.</p>
                                                      <p>See the <strong>@IncDb</strong> parameter above for a description of the wildcard characters.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Sample</h5>
                                   <h6>A. Make accessible all databases that are in "RESTORING" state</h6>
                                   <p>The following example make's accessible all databases that are in "RESTORING" state.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">-- This command must be executed on the SQL mirror instance.  
Exec YourSQLDba.Mirroring.DoRecovery 
@IncDb =   -- Each database inclusion filter must be 
           -- on its own line between the following single quotes:  
'  
'  
, @ExcDb = -- Each database exclusion filter must be 
           -- on its own line between the following single quotes: 
'  
'</code></pre>
                                   </div>
                                   <h6>B. Make accessible the selected databases that are in "RESTORING" state</h6>
                                   <p>The following example make's accessible the selected databases that are in "RESTORING" state.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">-- This command must be executed on the SQL mirror instance. 
Exec YourSQLDba.Mirroring.DoRecovery  
-- Each database inclusion filter must be  
-- on its own line between the following single quotes:  
@IncDb = 
'  
ACHAT  
Sales%  
'  
-- Each database exclusion filter must be  
-- on its own line between the following single quotes:  
, @ExcDb =             
'  
%[_]Test  
%temp[0-9]  
%temp[0-9][0-9] 
'</code></pre>
                                   </div>
                                </div>
                                <div id="Failover" class="section-block">
                                   <h3 class="block-title">Mirroring.Failover</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>This procedure performs a Failover to the standby server of the selected databases. Used in a upgrade process, for which the target instance is at a newer SQL Server version, it calls procedure Upgrade.MakeDbCompatibleToTarget.  This procedure set compatibility level of the database to SQL Server destination version. If the database is SQL2005, it upgrades fulltext catalogs to the new structure of higher version.  Databases selected on source instance are put offline as a mean to protect them from being accessed by an application and being modified instead of the one on the failover server.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Prerequisites to execute "Mirroring.Failover"</h4>
                                            <p>Having a working mirroring server.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h6>Workings of the "Mirroring.Failover" procedure</h6>
                                   <p>The <strong>Snapshot</strong> databases in the source server are excluded automatically from the list of selected databases.</p>
                                   <p>The <strong>Mirroring.Failover</strong> procedure executes the following steps for each selected database:</p>
                                   <ol>
                                      <li>It synchronizes the SQL connection codes from the source server to the mirror server.</li>
                                      <li>It checks that the database is <strong>Online</strong> in the source server.</li>
                                      <li>It checks if database to restore is not there, or there in restoring state on the mirror server.</li>
                                      <li>It checks that the database has been configured to be restored in a mirror server.</li>
                                      <li>It checks destination server version.</li>
                                      <li>It closes existing connections to the database and puts the database OFFLINE and then ONLINE to cut existing connextions in the source server.</li>
                                      <li>If the recovery model of the database is not <strong>Simple</strong>, the procedure executes a last log backup in the source server.</li>
                                      <li>If the recovery model of the database is <strong>Simple</strong>, the procedure executes a differential backup of the database in the source server.</li>
                                      <li>It puts the database <strong>(OffLine)</strong> in the source server.</li>
                                      <li>It restores the database’s log, differential on the destination server and makes the database accessible.</li>
                                      <li>It sets back database ownership to the original login</li>
                                      <li>It changes the compatibility level of the database in the mirror server to match instance version.</li>
                                   </ol>
                                   <p>When all databases have been processed, the <strong>Mirroring.Failover</strong> procedure shows the migration status of each database.</p>
                                   <div class="alert alert-info">You must perform a full backup of migrated databases on the mirror instance for databases that are not in simple recovery model.</div>
                                   <p>After the execution of the <strong>Mirroring.Failover</strong> procedure and for each databases with a recovery model <strong>Full</strong> or <strong>Bulk-logged</strong>, you must execute the <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> or <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a> procedure to generate a full backup for each migrated database in the mirror server.</p>
                                   <p>If there is no full backup of the database when the next log backup is executed, YourSQLDba will send an email to the database administrators to warn that a full backup must be done before making a log backup of theses databases.</p>
                                   <p>The email will lead you to the following error message:</p>
                                   <p><code>Log backup forbidden before doing a first full backup of [ "database name" ] status is "status of the database".</code></p>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@Simulation</td>
                                                    <td>
                                                      <p>Simulation mode to get potential error messages.</p>
                                                      <p>1 = yes.</p>
                                                      <p>0 = no (default).</p>
                                                      <p><code>(int)</code></p>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@IncDb</td>
                                                    <td>
                                                      <p>List of the databases to be processed.</p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>When left empty, all databases are selected.</p>
                                                      <p>Each database inclusion filter must be on its own line between the single quotes.</p>
                                                      <p>The databases names in the list, can include wildcard characters from the "Select" instruction "like" clause.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                      <table class="table table-bordered">
                                                         <thead>
                                                            <tr>
                                                               <th>Wildcard character</th>
                                                               <th>Description</th>
                                                               <th>Example</th>
                                                            </tr>
                                                         </thead>
                                                         <tbody>
                                                            <tr>
                                                               <td>%</td>
                                                               <td>Any string of zero or more characters.</td>
                                                               <td>'%base%' selects all databases names that contains the word "base" anywhere in the database name.</td>
                                                            </tr>
                                                            <tr>
                                                               <td>_ (underscore)</td>
                                                               <td>Any single character.</td>
                                                               <td>'an_' selects any three-letter database names beginning with the letters "an", like "An1" or "An9" or "AnF".</td>
                                                            </tr>
                                                            <tr>
                                                               <td>[0-9]</td>
                                                               <td>Any single character between 0 and 9.</td>
                                                               <td>'base[5-9]' selects any five-letter database names beginning with the letters "base", and followed by a number between 5 and 9, like « base5 » or « base9 ».</td>
                                                            </tr>
                                                            <tr>
                                                               <td>[_]</td>
                                                               <td>The underscore character.</td>
                                                               <td>'%[_]test' selects any database names ending with the characters "_test". The underscore between brackets is interpreted as a character instead of a wildcard character. It is the same behaviour with '%', ']' and '['.</td>
                                                            </tr>
                                                         </tbody>
                                                      </table>
                                                   </td>
                                                </tr>
                                                <tr>
                                                    <td>@ExcDb</td>
                                                    <td>
                                                      <p>List of databases to exclude from the database list generated by the <strong>@IncDb</strong> parameter.</p>
                                                      <p><strong>(Optional parameter)</strong>.</p>
                                                      <p>When the list is empty, no database is excluded.</p>
                                                      <p>Each database exclusion filter must be on its own line between the single quotes.</p>
                                                      <p>The databases names in the list, can include wildcard characters from the "Select" instruction "like" clause.</p>
                                                      <p>See the <strong>@IncDb</strong> parameter above for a description of the wildcard characters.</p>
                                                      <p><code>(NVarchar(max))</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Sample</h5>
                                   <h6>A. Migrate all databases to SQL Server 2008</h6>
                                   <p>The following example migrates all databases to SQL Server 2008.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">-- This command must be executed on the SQL source instance.  
Exec YourSQLDba.Mirroring.Failover    
  @Simulation = 0  
-- Each database inclusion filter must be 
-- on its own line between the following single quotes: '  
, @IncDb =  
' 
' 
-- Each database exclusion filter must be 
-- on its own line between the following single quotes: '  
, @ExcDb = 
' 
'</code></pre>
                                   </div>
                                   <h6>B. Migrate the selected databases to SQL Server 2008</h6>
                                   <p>The following example migrates the selected databases to SQL Server 2008.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">-- This command must be executed on the SQL source instance.  
 
Exec YourSQLDba.Mirroring.Failover 
  @Simulation = 0  
-- Each database inclusion filter must be 
-- on its own line between the following single quotes: '  
, @IncDb =  
'  
ACHAT  
Ventes%  
'  
-- Each database exclusion filter must be 
-- on its own line between the following single quotes: '   
, @ExcDb = 
' 
%[_]Test  
%temp[0-9]  
%temp[0-9][0-9] 
'</code></pre>
                                   </div>
                                </div>
                                <div id="MakeDbCompatibleToTarget" class="section-block">
                                   <h3 class="block-title">Upgrade.MakeDbCompatibleToTarget</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Set compatibility level to match target instance version. If source database is SQL2005, rebuild catalog structure accordingly to higher SQL version.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <h6>The " Upgrade. MakeDbCompatibleToTarget " procedure executes the following steps:</h6>
                                   <ol>
                                      <li>It changes the compatibility level of the database in the mirror server to match instance version.</li>
                                      <li>
                                          <p>It checks that the destination server is higher than SQL Server 2005 server, if it is the case:</p>
                                          <ul>
                                             <li>It puts the database in <strong>MULTI_USER</strong> mode.</li>
                                             <li>It creates a new FILEGROUP which contains all full text search indexes of the database.</li>
                                             <li>It populates the new indexes to benefit from the new full text search advances provided by newer SQL Server versions higher than <strong>SQL Server 2005</strong>.</li>
                                          </ul>
                                      </li>
                                   </ol>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@DbName</td>
                                                    <td>
                                                      <p>Name of the database to convert.</p>
                                                      <p><strong>Mandatory</strong>.</p>
                                                      <p><code>(sysname)</code></p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Example </h5>
                                   <h6>Finalize the manual migration (by backup restore) of a database</h6>
                                   <p>The following example finalize the migration of the database <strong>Database_to_be_converted</strong> to the SQL Server 2008 format.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">Exec YourSQLDba.Upgrade.MakeDbCompatibleToTarget  
　　@DbName = 'Database_to_be_converted'</code></pre>
                                   </div>
                                </div>
                                <div id="SetYourSqlDbaAccountForMirroring" class="section-block">
                                   <h3 class="block-title">Mirroring.SetYourSqlDbaAccountForMirroring</h3>
                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="far fa-lightbulb"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Purpose</h4>
                                            <p>Set a common password for YourSqlDba account when multiple server share a single mirror.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Prerequisite to execute</h4>
                                            <p>It changes linked server configurations used for mirroring. Some Mirror need to be defined.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                   <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parameter name</th>
                                                    <th>parameter description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@YourSqlDbaAccountForMirroringPwd</td>
                                                    <td>
                                                      <p>A common password to set for multiple source servers sharing a single mirror.  If no value is supplied, and a connection can't be made, it resets the password to a random generated value.</p>
                                                   </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                   <h5>Set YourSqlDba account password:</h5>
                                   <p>The following example make's accessible all databases that are in "RESTORING" state.</p>
                                   <div class="code-block">
                                       <pre><code class="language-sql">-- This command must be executed on the SQL mirror instance.  
Exec YourSQLDba.Mirroring.SetYourSqlDbaAccountForMirroring 
@YourSqlDbaAccountForMirroringPwd='YourSecretPasswordSauce'  
'</code></pre>
                                   </div>
                                </div>
                            </section>
                            <section id="releases" class="doc-section">
                                <h2 class="section-title">Releases</h2>
                                <div id="git-simple-man-reminder" class="section-block">
                                   <h3 class="block-title">Git simple man reminder</h3>
                                   <h5>Do this once at start to get a local repository from remote repository.</h5>
                                   <p><code>GIT clone <a href="https://github.com/pelsql/YourSqlDba">https://github.com/pelsql/YourSqlDba.git</a></code></p>
                                   <h5>Git branch shows the current working branch (usually I use only master)</h5>
                                   <p><code>GIT branch</code></p>
                                   <h5>Perform changes, and at the end do Git Status to not forget to stage changes</h5>
                                   <p><code>GIT status</code> (show changed files, unstaged one in red)</p>
                                   <h5>Stage files to commit, GIT add to stage files/directories (new or modified one), GIT rm to remove</h5>
                                   <p><code>GIT add  filename/directories</code></p>
                                   <p><code>GIT rm filename/directories</code></p>
                                   <h5>Do Git Status to not forget changed stuff,  stuff is displayed in green in git shell</h5>
                                   <p><code>GIT status</code></p>
                                   <ul>
                                      <li>In case something is messed and you want to undo the changes see this <a href="https://github.blog/2015-06-08-how-to-undo-almost-anything-with-git/">excellent explantion</a></li>
                                      <li>See Git revert sha, git checkout etc.</li>
                                      <li>Otherwise commit it</li>
                                   </ul>
                                   <h5>Return changes to GIT remote repo</h5>
                                   <p><code>GIT commit</code></p>
                                   <p><code>GIT Push</code></p>
                                </div>
                            </section>
                            <section id="database-recovery" class="doc-section">
                                <h2 class="section-title">Database recovery</h2>
                                <p>See <a href="#database-recovery-with-yoursqldba">Database recovery with YourSqlDba</a></p>
                            </section>
                            <section id="initial-setup-or-upgrade" class="doc-section">
                                <h2 class="section-title">Initial Setup or Upgrade</h2>
                                <div id="initial-setup" class="section-block">
                                   <h3 class="block-title">Initial setup</h3>
                                   <p>Initial setup is mandatory after YourSqlDba <a href="#first-install-or-upgrade">First install or upgrade</a>, or when renaming/dropping recreating YourSqlDba database.</p>
                                   <p>This procedure sets default backup locations for database backup and logs.  It also sets SMTP email server that is going to be used by SQL Database Mail to send maintenance job report or alerts, and email recipients for them.</p>
                                   <p>Initial setup creates also two maintenance jobs in SQL Agent.  The first one does daily maintenance at midnight and the second one regular logs backups (every 15 minutes).  Daily maintenance does database optimization, database consistency check and initial daily database full and log backups.</p>
                                   <p>The maintenance jobs have each a single step that call SQL stored procedure <a href="#YourSQLDba_DoMaint">Maint.YourSqlDba_DoMaint</a>.  This procedure have several parameters and some comes from running <a href="#InitialSetupOfYourSQLDba">Install.InitialSetupOfYourSqlDba</a>.</p>
                                   <p>See <a href="#InitialSetupOfYourSQLDba">Install.InitialSetupOfYourSqlDba</a> description for parameters and some samples.</p>
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fas fa-info-circle"></i>
                                        </div>
                                        <!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">NOTE</h4>
                                            <p><a href="#InitialSetupOfYourSQLDba">Install.InitialSetupOfYourSqlDba</a> recreates the jobs default definition for daily maintenance and log backups.</p>
                                        </div>
                                        <!--//content-->
                                    </div>
                                </div>
                                <div id="first-install-or-upgrade" class="section-block">
                                   <h3 class="block-title">First install or upgrade</h3>
                                   <p>Upgrading YourSqlDba is as simple as getting the script by clicking the link in <a href="#quickstart-section">YourSqlDba Quick Start</a> to display the script. Just copy/paste the script into SQL Management Studio query window and be run itan by hitting F5 key.</p>
                                   <p>The script is meant to be upgradable from any previous version.  It does a backup of the existing YourSqlDba database, drops it and create a new one.  If you ran into problems when upgrading, just try to re-run it.  Sometimes it solves the problem.</p>
                                   <p>Upgrades preserves YourSqlDba agent jobs.</p>
                                </div>
                            </section>
                            <section id="manual-backup-or-restore" class="doc-section">
                                <h2 class="section-title">Manual backup or restore</h2>
                                <p>See <a href="#manual-backup-restore-procedures">Manual backup/restore procedures</a></p>
                            </section>
                            <section id="exclusive-access-for-database-upgrade" class="doc-section">
                                <h2 class="section-title">Exclusive access for database upgrade</h2>
                                <p>See <a href="#exclusive-access-and-backups-for-database-maintenance">Exclusive access and backups for database upgrades</a> to know how get automatic backups and exclusive access before database maintenance to upgrade it. These procedures allows quickest setup of what it need be ready to do single/multiple database upgrades, and safety procedure to rollback failed databases upgrade.</p>
                            </section>
                            <section id="diagnostics-on-maintenance-and-performance" class="doc-section">
                                <h2 class="section-title">Diagnostics on maintenance and performance</h2>
                                <p>See this section <a href="#diagnostics-maintenance-performance">Diagnostics (maintenance, performance)</a> to find out how helpful are YourSqlDba diagnostics tools, and to get some goodies about performance diagnosis in general from YourSqlDba stored procedures.</p>
                            </section>
                            <section id="setting-up-yoursqldba-mirror-stand-by-server" class="doc-section">
                                <h2 class="section-title">Setting up YourSqlDba mirror-stand by server</h2>
                                <p>See <a href="#Mirroring">Mirroring</a> to read more about this subject.  Mirroring with YourSqlDba is quite easly to set up and it adds the value of having a server ready to be promoted to become the production server in case of source server failure.</p>
                                <p>Moreover it offers the value of making an automatic verification of your backups <strong>which is the most important</strong> thing aside doing backup themselves.</p>
                                <p>Steps to install SQL Server mirroring.</p>
                                 <div class="callout-block callout-info">
                                       <div class="icon-holder">
                                          <i class="fas fa-info-circle"></i>
                                       </div>
                                       <!--//icon-holder-->
                                       <div class="content">
                                          <h4 class="callout-title">SQL mirror instance usefulness</h4>
                                          <ul>
                                             <li>The SQL mirror instance can become a SQL failover server.</li>
                                             <li>Restoring database backups checks the backup files integrity.</li>
                                             <li>A SQL Server 2008 mirror instance can be used to migrate databases from <strong>SQL Server 2005</strong> to <strong>SQL Server 2008</strong>.</li>
                                          </ul>
                                       </div>
                                       <!--//content-->
                                 </div>
                                 <h5>Prerequisite to use a SQL mirror server</h5>
                                 <ol>
                                    <li>Both SQL instances must be at the same version of YourSQLDba version number. Run YourSqlDba stored procedure <a href="#PrintVersionInfo">Install.PrintVersionInfo</a> to see the version number of YourSQLDba present on a server.</li>
                                    <li>Backup folders must be accessible by both instances and expressed in UNC format like <code>'\\server name\backup folder'</code>.</li>
                                    <li>The @FullBackupPath and @LogBackupPath parameters of the <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> procedure in the SQL maintenance job executed by the SQL Server Agent in the SQL origin server, must use a UNC format like <code>'\\servername\backupfolder'</code>. Often you must specify parameter @ReplacePathsInDbFileNames which is mandatory in many circumstances.</li>
                                    <li>@replace</li>
                                    <li>Origin SQL instance startup account must have access to the <strong>mirror</strong> server with <strong>sysadmin</strong> rights.</li>
                                    <li>On the first export, the databases must not exist on the mirror instance.</li>
                                    <li>The databases to be restored on the mirror instance will be must remain in <strong>RESTORING</strong> state on the mirror instance while this SQL instance is a mirror for the database.</li>
                                 </ol>
                                 <h5>Steps to configure an SQL mirror instance</h5>
                                 <ol>
                                    <li>
                                       <p>Choose an SQL instance which will be used as a SQL mirror for the databases to be restored. The selected SQL mirror instance and the SQL instance of origin must respect the following conditions:</p>
                                       <ul>
                                          <li>The SQL instance of origin must be a version of SQL Server lower or equal the mirroring server and be at least SQL2005.</li>
                                       </ul>
                                    </li>
                                    <li>Install the same version of YourSQLDba in the SQL instance of origin and in the SQL mirror instance.</li>
                                    <li>Insure that you are able to connect directly from origin SQL Server to the target server form a session opened onto the origin server through SQL Server Management Studio.</li>
                                    <li>Create a login on the <strong>mirror</strong> server with <strong>sysadmin</strong> rights for the <strong>source</strong> SQL instance startup account.</li>
                                    <li>The source server <strong>full backup</strong> directory must be shared to this account. The <strong>source</strong> SQL instance startup account (<strong>Domain\AdminAccount</strong>) must have total control on the directory.</li>
                                    <li>The source server <strong>log backup</strong> directory must be shared. The <strong>source</strong> SQL instance startup account (<strong>Domain\AdminAccount</strong>) must have total control on the directory.</li>
                                    <li>Execute the <a href="#AddServer">Mirroring.AddServer</a> procedure in the SQL instance of origin.</li>
                                    <li>
                                       <p>Edit the global maintenance job <strong>YourSQLDba_FullBackups_And_Maintenance</strong> script in <strong>SQL Server Agent</strong> in the SQL instance of origin which executes the <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> procedure.</p>
                                       <ul>
                                          <li>
                                             <p>Add the @MirrorServer parameter.</p>
                                             <p>The @FullBackupPath and @LogBackupPath parameters must use a UNC format like <code>'\\servername\backupfolder'</code>.
                                          </li>
                                          <li>
                                             <p>Edit the log backup maintenance job <strong>YourSQLDba_LogBackups</strong> script in <strong>SQL Server Agent</strong> in the SQL instance of origin which executes the <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> procedure.</p>
                                             <p>Add the @MirrorServer parameter.</p>
                                             <p>The @FullBackupPath and @LogBackupPath parameters must use a UNC format like <code>'\\servername\backupfolder'</code>.</p>
                                          </li>
                                       </ul>
                                    </li>
                                    <li>Start the global maintenance job in <strong>SQL Server Agent</strong> in the SQL instance of origin.</li>
                                 </ol>
                                 <h5>How the data is sent to the SQL mirror instance</h5>
                                 <p>When the <a href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMaint</a> procedure or the <a href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a> procedure are executed with the @MirrorServer parameter these procedures executes two supplementary steps:</p>
                                 <ol>
                                    <li>Restoration of the databases to the SQL mirror instance.  If the restore operation fails, an error email is sent to the SQL administrator.</li>
                                    <li>Copy all SQL logins from the SQL instance of origin to the SQL mirror instance. This insure that they share the same password and attributes and will allow the mirror instance to eventually become a failover SQL server.</li>
                                 </ol>
                                 <h5>To put Online databases on the mirror server you have three possibilities</h5>
                                 <ol>
                                    <li>
                                       <p>How to switch applications links to the failover SQL mirror instance when the source server is out of service</p>
                                       <ul>
                                          <li>Execute the <a href="#DoRecovery">Mirroring.DoRecovery</a> procedure on the SQL <strong>mirror</strong> instance to bring stand-by databases online.</li>
                                          <li>Adjust SQL connection string or ODBC's definition for the applications to use the failover SQL mirror instance.</li>
                                       </ul>
                                    </li>
                                    <li>
                                       <p>How to switch applications links to the failover SQL mirror instance when the source server is available</p>
                                       <ul>
                                          <li>Execute the <a href="#Failover">Mirroring.Failover</a> procedure on the SQL <strong>source</strong> instance to bring online the databases.</li>
                                          <li>Adjust SQL connection string or ODBC's definition for the applications to use the failover SQL mirror instance.</li>
                                       </ul>
                                    </li>
                                    <li>
                                       <p>How to switch applications links to the failover SQL mirror instance to make databases available for testing, with no effect on the source databases</p>
                                       <ul>
                                          <li>Execute the <a href="#DoRecovery">Mirroring.DoRecovery</a> procedure on the SQL <strong>mirror</strong> instance to bring online the databases.</li>
                                          <li>Adjust SQL connection string or ODBC's definition for the applications to use the failover SQL mirror instance.</li>
                                       </ul>
                                    </li>
                                 </ol>
                            </section>
                            <section id="workarounds-in-case-of-problems" class="doc-section">
                                <h2 class="section-title">Workarounds in case of problems</h2>
                                <p>YourSqlDba logs everything it does in [Maint].[JobHistoryDetails].  When an error is encountered it sends you a message that contains the command to run to filter out errors encountered in maintenance.  It is usually something like <code>Exec [Maint].[ShowHistoryErrors] <em>jobnumber, 1</em></code>.</p>
                                <p>This listing produces rows into which each maintenance command that raise an error is displayed with much details about its execution (command, centext info and error messages).  It looks like an hyperlink because it is in XML format. Click on it to have it in a more readable XML form.</p>
                                <p>Usually the error message give good hints about the source of the error.  But if it tells you nothing that could be explained (like lack of disk space, or lost access rights to a directory), you can reset YourSqlDba inner workings by recreating YourSqlDba database.  It changes nothing to YourSqlDba tasks.</p>
                                <p>YourSqlDba database contains only code and job history information.  If you run into a rare YourSqlDba behavior problem and want a simple workaround, or if you encounters a problem when updating YourSqlDba do the following:</p>
                                 <ol>
                                    <li>Get the latest version of the script and re-run it.  It will recreate a new YourSqlDba database.</li>
                                    <li>Get a copy of the script in job step "Exec YourSQLDba: Maintenance and Full Backups" of YourSQLDba_FullBackups_And_Maintenance job.  Remove parameters @DoInteg, @DoReorg,  @DoUpdStats, and execute it manually in a query windows. This perform full database backups, and initialize Maint.JobLastBkpLocations.</li>
                                 </ol>
                                <p>You can also retry this with an earlier version, if you think the problem appeared with the brand new version.</p>
                            </section>
                            <section id="automate-maintenance" class="doc-section">
                                <h2 class="section-title">Automate maintenance</h2>
                                <p>See <a href="#automatic-maintenance">Automatic maintenance related procedures</a></p>
                            </section>
                            <section id="planned-enhancements" class="doc-section">
                                <h2 class="section-title">Planned enhancements</h2>
                                <div id="auto-detect-for-global-run-failure-on-express-editions" class="section-block">
                                    <h3 class="block-title">Auto-detect for global run failure on Express Editions</h3>
                                    <p>SQL Express Edition doesn't have an SQLAgent capable of reporting run failure.  So there is no way to detect through YourSqlDba a global run failure.</p>
                                    <p>This type of failure is not the same as those reported by YourSqlDba, when YourSqlDba generate a maintenance command</p>
                                    <p>For this platform, a planned enhancement would be to set a flag in YourSqlDba database stating that the maintenance started, and clearing the flag once maintenance got through. If the flag is there on the next run, this is an indication that YourSqlDba failed.</p>
                                </div>
                                <div id="option-to-remove-date-information-in-backup-name" class="section-block">
                                    <h3 class="block-title">Option to remove date information in backup name</h3>
                                    <p>For those using de-duplication backup technologies, keeping same backup name is a must.  It reduces backup volume, and license cost as it is based on amount of difference in data saved.</p>
                                    <p>This option would only apply to full backup.</p>
                                </div>
                                <div id="auto-differential-backup-when-log-chain-is-broken" class="section-block">
                                    <h3 class="block-title">Auto-differential backup when log chain is broken</h3>
                                    <p>When a user needs temporarily to put a database in simple recovery mode, and forget to put it back in full recovery mode, he receives error messages from YourSqlDba on next attempt to do log backup.  SQL Server detect that the log chain is broken, since the database was put in simple recovery mode.  Doing a log backup would be useless, because in simple recovery model, inactive transactions are removed from the log, and are "forgotten".</p>
                                    <p>We could do a full backup to solve the problem, but doing a differential backup solves also this problem, and subsequent log backup are allowed.  A differential backup is usually much smaller so this is a better solution.</p>
                                    <p>However we have to check how well the code that does restoring at YourSqlDba mirror would need some modification to handle backup history information.</p>
                                </div>
                            </section>
                        </div>
                        <!--//content-inner-->
                    </div>
                    <!--//doc-content-->
                    <div class="doc-sidebar col-md-3 col-12 order-0 d-none d-md-flex">
                        <div id="doc-nav" class="doc-nav">

                            <nav id="doc-menu" class="nav doc-menu flex-column sticky">
                                <a class="nav-link scrollto" href="#intro-section">Introduction</a>
                                <a class="nav-link scrollto" href="#installation-section">Installation</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#step1">Step One</a>
                                    <a class="nav-link scrollto" href="#step2">Step Two</a>
                                    <a class="nav-link scrollto" href="#step3">Your Contribution</a>
                                </nav>
                                <!--//nav-->
                                <a class="nav-link scrollto" href="#quickstart-section">Quick start</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#summary-for-dba">YourSqlDba Summary for DBA</a>
                                    <a class="nav-link scrollto" href="#goodies-for-dba">Goodies for DBA</a>
                                    <a class="nav-link scrollto" href="#release-6">Release 6</a>
                                    <a class="nav-link scrollto" href="#disabling-telemetry">Why disabling SQL Server
                                        Telemetry</a>
                                </nav>
                                <!--//nav-->
                                <a class="nav-link scrollto" href="#reference">Reference</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#automatic-maintenance">Automatic maintenance</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#YourSQLDba_DoMaint">Maint.YourSQLDba_DoMain</a>
                                    </nav>
                                </nav>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#installation-related-procedures">Installation related procedures</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#InitialSetupOfYourSQLDba">Install.InitialSetupOfYourSQLDba</a>
                                        <a class="nav-link scrollto" href="#PrintVersionInfo">Install.PrintVersionInfo</a>
                                        <a class="nav-link scrollto" href="#AddOrReplaceMaintenance">Install.AddOrReplaceMaintenance</a>
                                        <a class="nav-link scrollto" href="#UpdateMaintenanceTasksParam">Install.UpdateMaintenanceTasksParam</a>
                                        <a class="nav-link scrollto" href="#UpdateMaintenanceTasksParam">Install.UpdateMaintenanceTasksParam</a>
                                    </nav>
                                    <a class="nav-link scrollto" href="#database-recovery-with-yoursqldba">Database recovery with YourSqlDba</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#BringBackOnlineAllBdInEmergencyOrOffline">Maint.BringBackOnlineAllBdInEmergencyOrOffline</a>
                                        <a class="nav-link scrollto" href="#RestoreDb">Maint.RestoreDb</a>
                                    </nav>
                                    <a class="nav-link scrollto" href="#manual-backup-restore-procedures">Manual backup/restore procedures</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#SaveDbOnNewFileSet">Maint.SaveDbOnNewFileSet</a>
                                        <a class="nav-link scrollto" href="#SaveDbCopyOnly">Maint.SaveDbCopyOnly</a>
                                        <a class="nav-link scrollto" href="#DuplicateDb">Maint.DuplicateDb</a>
                                        <a class="nav-link scrollto" href="#DeleteOldBackups">Maint.DeleteOldBackups</a>
                                    </nav>
                                    <a class="nav-link scrollto" href="#exclusive-access-and-backups-for-database-maintenance">Exclusive access and backups for database maintenance</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#PrepDbForMaintenanceMode">Maint.PrepDbForMaintenanceMode</a>
                                        <a class="nav-link scrollto" href="#RestoreDbAtStartOfMaintenanceMode">Maint.RestoreDbAtStartOfMaintenanceMode</a>
                                        <a class="nav-link scrollto" href="#ReturnDbToNormalUseFromMaintenanceMode">Maint.ReturnDbToNormalUseFromMaintenanceMode</a>
                                    </nav>
                                    <a class="nav-link scrollto" href="#diagnostics-maintenance-performance">Diagnostics (maintenance, performance)</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#ShowHistory">Maint.ShowHistory</a>
                                        <a class="nav-link scrollto" href="#ShowHistoryErrors">Maint.ShowHistoryErrors</a>
                                        <a class="nav-link scrollto" href="#ResetAnalyzeWaitStats">PerfMon.ResetAnalyzeWaitStats</a>
                                        <a class="nav-link scrollto" href="#AnalyzeWaitStats">PerfMon.AnalyzeWaitStats</a>
                                        <a class="nav-link scrollto" href="#DiagDbMail">Maint.DiagDbMail</a>
                                    </nav>
                                    <a class="nav-link scrollto" href="#managing-network-drives-for-backup-purposes">Managing network drives for backup purposes</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#CreateNetworkDrives">Maint.CreateNetworkDrives</a>
                                        <a class="nav-link scrollto" href="#DisconnectNetworkDrive">Maint.DisconnectNetworkDrive</a>
                                        <a class="nav-link scrollto" href="#ListNetworkDrives">Maint.ListNetworkDrives</a>
                                    </nav>
                                    <a class="nav-link scrollto" href="#Mirroring">Mirroring</a>
                                    <nav class="doc-sub-menu nav flex-column">
                                        <a class="nav-link scrollto" href="#AddServer">Mirroring.AddServer</a>
                                        <a class="nav-link scrollto" href="#DoRecovery">Mirroring.DoRecovery</a>
                                        <a class="nav-link scrollto" href="#Failover">Mirroring.Failover</a>
                                        <a class="nav-link scrollto" href="#MakeDbCompatibleToTarget">Upgrade.MakeDbCompatibleToTarget</a>
                                        <a class="nav-link scrollto" href="#SetYourSqlDbaAccountForMirroring">Mirroring.SetYourSqlDbaAccountForMirroring</a>
                                    </nav>
                                </nav>
                                <!--//nav-->
                                <a class="nav-link scrollto" href="#releases">Releases</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#git-simple-man-reminder">Git simple man reminder</a>
                                </nav>
                                <a class="nav-link scrollto" href="#database-recovery">Database recovery</a>
                                <a class="nav-link scrollto" href="#initial-setup-or-upgrade">Initial Setup or Upgrade</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#initial-setup">Initial setup</a>
                                    <a class="nav-link scrollto" href="#first-install-or-upgrade">First install or upgrade</a>
                                </nav>
                                <a class="nav-link scrollto" href="#manual-backup-or-restore">Manual backup or restore</a>
                                <a class="nav-link scrollto" href="#exclusive-access-for-database-upgrade">Exclusive access for database upgrade</a>
                                <a class="nav-link scrollto" href="#diagnostics-on-maintenance-and-performance">Diagnostics on maintenance and performance</a>
                                <a class="nav-link scrollto" href="#setting-up-yoursqldba-mirror-stand-by-server">Setting up YourSqlDba mirror-stand by server</a>
                                <a class="nav-link scrollto" href="#workarounds-in-case-of-problems">Workarounds in case of problems</a>
                                <a class="nav-link scrollto" href="#automate-maintenance">Automate maintenance</a>
                                <a class="nav-link scrollto" href="#planned-enhancements">Planned enhancements</a>
                                <nav class="doc-sub-menu nav flex-column">
                                    <a class="nav-link scrollto" href="#auto-detect-for-global-run-failure-on-express-editions">Auto-detect for global run failure on Express Editions</a>
                                    <a class="nav-link scrollto" href="#option-to-remove-date-information-in-backup-name">Option to remove date information in backup name</a>
                                    <a class="nav-link scrollto" href="#auto-differential-backup-when-log-chain-is-broken">Auto-differential backup when log chain is broken</a>
                                </nav>
                            </nav>
                            <!--//doc-menu-->

                        </div>
                    </div>
                    <!--//doc-sidebar-->
                </div>
                <!--//doc-body-->
            </div>
            <!--//container-->
        </div>
        <!--//doc-wrapper-->

    </div>
    <!--//page-wrapper-->

    <footer id="footer" class="footer text-center">
        <div class="container">
            <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can buy the commercial license via our website: themes.3rdwavemedia.com */-->
            <small class="copyright">Designed with <i class="fas fa-heart"></i> by <a href="https://themes.3rdwavemedia.com/"
                    target="_blank">Xiaoying Riley</a> for developers</small>

        </div>
        <!--//container-->
    </footer>
    <!--//footer-->

    <!-- Main Javascript -->
    <script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/plugins/prism/prism.js"></script>
    <script type="text/javascript" src="assets/js/main.js"></script>
</body>
</html>
